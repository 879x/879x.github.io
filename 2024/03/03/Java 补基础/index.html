<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>java 基础 | 幻季的个人博客</title><meta name="author" content="幻季"><meta name="copyright" content="幻季"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="IO 流一、什么是 IO 流 I : Input O: Output  二、流的分类 按照流的方向 输入 (Input) 也就是 读 (Read) 输出 (Output) 也就是 写 (Write)   按照读取数据方式 字节：一次读取 1 个字节 byte，等同于一次读取 8 个二进制位，这种流什么类型的文件都可以读取。包括：文本文件，图片，声音文件，视频文件等… 字符：一次读取 1 个字符，这">
<meta property="og:type" content="article">
<meta property="og:title" content="java 基础">
<meta property="og:url" content="https://879x.github.io/2024/03/03/Java%20%E8%A1%A5%E5%9F%BA%E7%A1%80/">
<meta property="og:site_name" content="幻季的个人博客">
<meta property="og:description" content="IO 流一、什么是 IO 流 I : Input O: Output  二、流的分类 按照流的方向 输入 (Input) 也就是 读 (Read) 输出 (Output) 也就是 写 (Write)   按照读取数据方式 字节：一次读取 1 个字节 byte，等同于一次读取 8 个二进制位，这种流什么类型的文件都可以读取。包括：文本文件，图片，声音文件，视频文件等… 字符：一次读取 1 个字符，这">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://879x.github.io/img/wallhaven-p22lwj.webp">
<meta property="article:published_time" content="2024-03-03T02:08:53.000Z">
<meta property="article:modified_time" content="2024-04-02T07:27:34.572Z">
<meta property="article:author" content="幻季">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://879x.github.io/img/wallhaven-p22lwj.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://879x.github.io/2024/03/03/Java%20%E8%A1%A5%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'java 基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-02 15:27:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background-color.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/wallhaven-p22lwj.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="幻季的个人博客"><span class="site-name">幻季的个人博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">java 基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-03T02:08:53.000Z" title="发表于 2024-03-03 10:08:53">2024-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-02T07:27:34.572Z" title="更新于 2024-04-02 15:27:34">2024-04-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B/">编程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>107分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="java 基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="IO-流"><a href="#IO-流" class="headerlink" title="IO 流"></a>IO 流</h1><h2 id="一、什么是-IO-流"><a href="#一、什么是-IO-流" class="headerlink" title="一、什么是 IO 流"></a>一、什么是 IO 流</h2><ul>
<li>I : Input</li>
<li>O: Output</li>
</ul>
<h2 id="二、流的分类"><a href="#二、流的分类" class="headerlink" title="二、流的分类"></a>二、流的分类</h2><ul>
<li>按照流的方向<ul>
<li>输入 (Input) 也就是 读 (Read)</li>
<li>输出 (Output) 也就是 写 (Write)</li>
</ul>
</li>
<li>按照读取数据方式<ul>
<li>字节：一次读取 1 个字节 byte，等同于一次读取 8 个二进制位，这种流什么类型的文件都可以读取。包括：文本文件，图片，声音文件，视频文件等…</li>
<li>字符：一次读取 1 个字符，这种流方便读取 <code>普通文本文件</code> 而存在的，这种流不能读取：图片、声音、视频等文件。只能读取 <code>纯文本文件</code>，连 word 文件都无法读取。</li>
</ul>
</li>
</ul>
<h2 id="三、IO-流抽象类"><a href="#三、IO-流抽象类" class="headerlink" title="三、IO 流抽象类"></a>三、IO 流抽象类</h2><ul>
<li><p>字节流</p>
<ol>
<li>java.io.<strong>InputStream</strong> 字节输入流</li>
<li>java.io.<strong>OutputStream</strong> 字节输出流</li>
</ol>
</li>
<li><p>字符流</p>
<ol start="3">
<li><p>java.io.<strong>Reader</strong> 字符输入流</p>
</li>
<li><p>java.io.<strong>Writer</strong> 字符输出流</p>
</li>
</ol>
</li>
</ul>
<p>注意：</p>
<ol>
<li>所有的流都实现了：<strong>java.io.Closeable</strong>接口，都是<strong>可关闭</strong>的，都有 <strong><code>close()</code></strong> 方法。用完一定要关闭</li>
<li>所有的<code>输出流</code>都实现了<strong>java.io.Flushable</strong>接口，都是<strong>可刷新</strong>的，都有 <strong><code>flush()</code></strong> 方法。输出流在最终输出之后，一定要记得 flush() 刷新一下。这个刷新表示将通道&#x2F;管道当中剩余未输出的<strong>数据强行输出完</strong>（清空管道！）刷新的作用就是<strong>清空管道</strong>。</li>
<li>在 java 中只要“<strong>类名</strong>”以 <strong><code>Stream</code></strong> 结尾的都是<strong>字节流</strong>。以“ <strong><code>Reader/Writer</code></strong> ”结尾的都是<strong>字符流</strong>。</li>
</ol>
<h2 id="四、Java-要掌握的流-16-个"><a href="#四、Java-要掌握的流-16-个" class="headerlink" title="四、Java 要掌握的流 (16 个)"></a>四、Java 要掌握的流 (16 个)</h2><ol>
<li><p><strong>文件</strong>专属：</p>
<ul>
<li><p>java.io.FileInputStream（掌握）</p>
</li>
<li><p>java.io.FileOutputStream（掌握）</p>
</li>
<li><p>java.io.FileReader</p>
</li>
<li><p>java.io.FileWriter</p>
</li>
</ul>
</li>
<li><p><strong>转换流</strong>：（将字节流转换成字符流）</p>
<ul>
<li><p>java.io.InputStreamReader</p>
</li>
<li><p>java.io.OutputStreamWriter</p>
</li>
</ul>
</li>
<li><p><strong>缓冲流</strong>专属：</p>
<ul>
<li><p>java.io.BufferedReader</p>
</li>
<li><p>java.io.BufferedWriter</p>
</li>
<li><p>java.io.BufferedInputStream</p>
</li>
<li><p>java.io.BufferedOutputStream</p>
</li>
</ul>
</li>
<li><p><strong>数据流</strong>专属：</p>
<ul>
<li><p>java.io.DataInputStream</p>
</li>
<li><p>java.io.DataOutputStream</p>
</li>
</ul>
</li>
<li><p><strong>标准输出</strong>流：</p>
<ul>
<li><p>java.io.PrintWriter</p>
</li>
<li><p>java.io.PrintStream（掌握）</p>
</li>
</ul>
</li>
<li><p><strong>对象专属</strong>流：</p>
<ul>
<li><p>java.io.ObjectInputStream（掌握）</p>
</li>
<li><p>java.io.ObjectOutputStream（掌握）</p>
</li>
</ul>
</li>
<li><p><strong>File 文件类</strong></p>
<ul>
<li>java.io.File</li>
</ul>
</li>
</ol>
<p>补充：<br>Windows 各个文件的分隔符为：”\“,Linux 各个文件的分隔符为：”&#x2F;“</p>
<h2 id="五、类的方法"><a href="#五、类的方法" class="headerlink" title="五、类的方法"></a>五、类的方法</h2><h3 id="1-FileInputStream"><a href="#1-FileInputStream" class="headerlink" title="1. FileInputStream"></a>1. FileInputStream</h3><p>文件字节输入流，万能的，任何类型的文件都可以采用这个流来读</p>
<h4 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4><table>
<thead>
<tr>
<th align="center">构造方法名</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FileInputStream(String name)</td>
<td align="center">name 为文件路径</td>
</tr>
<tr>
<td align="center">FileInputStream(File file)</td>
<td align="center"></td>
</tr>
</tbody></table>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int read()</td>
<td align="center">读取一个字节，返回值为该字节 ASCII 码；读到文件末尾返回-1</td>
</tr>
<tr>
<td align="center">int read(byte[] b)</td>
<td align="center">读 b 数组长度的字节到 b 数组中，返回值为读到的字节个数；读到文件末尾返回-1</td>
</tr>
<tr>
<td align="center">int read(byte[] b, int off, int len)</td>
<td align="center">从 b 数组 off 位置读 len 长度的字节到 b 数组中，返回值为读到的字节个数；读到文件末尾返回-1</td>
</tr>
<tr>
<td align="center">int available()</td>
<td align="center">返回文件有效的字节数</td>
</tr>
<tr>
<td align="center">long skip(long n)</td>
<td align="center">跳过 n 个字节</td>
</tr>
<tr>
<td align="center">void close()</td>
<td align="center">关闭文件输入流</td>
</tr>
</tbody></table>
<h3 id="2-FileOutputStream"><a href="#2-FileOutputStream" class="headerlink" title="2. FileOutputStream"></a>2. FileOutputStream</h3><h4 id="构造方法-1"><a href="#构造方法-1" class="headerlink" title="构造方法"></a>构造方法</h4><table>
<thead>
<tr>
<th align="center">构造方法名</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FileOutputStream(String name)</td>
<td align="center">name 为文件路径</td>
</tr>
<tr>
<td align="center">FileOutputStream(String name, boolean append)</td>
<td align="center">name 为文件路径，append 为 true 表示在文件末尾追加；为 false 表示清空文件内容，重新写入</td>
</tr>
<tr>
<td align="center">FileOutputStream(File file)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">FileOutputStream(File file, boolean append)</td>
<td align="center">append 为 true 表示在文件末尾追加；为 false 表示清空文件内容，重新写入</td>
</tr>
</tbody></table>
<h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">void write(int b)</td>
<td align="center">将指定字节写入文件中</td>
</tr>
<tr>
<td align="center">void write(byte[] b)</td>
<td align="center">将 b.length 个字节写入文件中</td>
</tr>
<tr>
<td align="center">void write(byte[] b, int off, int len)</td>
<td align="center">将 b 数组 off 位置开始，len 长度的字节写入文件中</td>
</tr>
<tr>
<td align="center">void flush()</td>
<td align="center">刷新此输出流并强制写出所有缓冲的输出字节</td>
</tr>
<tr>
<td align="center">void close()</td>
<td align="center">关闭文件输出流</td>
</tr>
</tbody></table>
<h3 id="3-FileReader"><a href="#3-FileReader" class="headerlink" title="3. FileReader"></a>3. FileReader</h3><p>FileReader 文件字符输入流，只能读取普通文本。读取文本内容时，比较方便，快捷。</p>
<h4 id="构造方法-2"><a href="#构造方法-2" class="headerlink" title="构造方法"></a>构造方法</h4><table>
<thead>
<tr>
<th align="center">构造方法名</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FileReader(String fileName)</td>
<td align="center">name 为文件路径</td>
</tr>
<tr>
<td align="center">FileReader(File file)</td>
<td align="center"></td>
</tr>
</tbody></table>
<h4 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h4><table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int read()</td>
<td align="center">读取一个字符，返回值为该字符 ASCII 码；读到文件末尾返回-1</td>
</tr>
<tr>
<td align="center">int read(char[] c)</td>
<td align="center">读 c 数组长度的字节到 c 数组中，返回值为读到的字符个数；读到文件末尾返回-1</td>
</tr>
<tr>
<td align="center">int read(char[] c, int off, int len)</td>
<td align="center">从 c 素组 off 位置读 len 长度的字符到 c 数组中，返回值为读到的字符个数；读到文件末尾返回-1</td>
</tr>
<tr>
<td align="center">long skip(long n)</td>
<td align="center">跳过 n 个字符</td>
</tr>
<tr>
<td align="center">void close()</td>
<td align="center">关闭文件输入流</td>
</tr>
</tbody></table>
<h3 id="4-FileWriter"><a href="#4-FileWriter" class="headerlink" title="4. FileWriter"></a>4. FileWriter</h3><p>FileWriter 文件字符输出流。写。只能输出普通文本</p>
<h4 id="构造方法-3"><a href="#构造方法-3" class="headerlink" title="构造方法"></a>构造方法</h4><table>
<thead>
<tr>
<th align="center">构造方法名</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">FileWriter(String fileName)</td>
<td align="center">name 为文件路径</td>
</tr>
<tr>
<td align="center">FileWriter(String fileName, boolean append)</td>
<td align="center">name 为文件路径，append 为 true 表示在文件末尾追加；为 false 表示清空文件内容，重新写入</td>
</tr>
<tr>
<td align="center">FileWriter(File file)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">FileWriter(File file, boolean append)</td>
<td align="center">append 为 true 表示在文件末尾追加；为 false 表示清空文件内容，重新写入</td>
</tr>
</tbody></table>
<h4 id="方法-3"><a href="#方法-3" class="headerlink" title="方法"></a>方法</h4><table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">void write(int c)</td>
<td align="center">将指定字符写入文件中</td>
</tr>
<tr>
<td align="center">void write(char[] c)</td>
<td align="center">将 c.length 个字符写入文件中</td>
</tr>
<tr>
<td align="center">void write(char[] c, int off, int len)</td>
<td align="center">将 c 数组 off 位置开始，len 长度的字符写入文件中</td>
</tr>
<tr>
<td align="center">void write(String str)</td>
<td align="center">将字符串写入文件中</td>
</tr>
<tr>
<td align="center">void write(String str, int off, int len)</td>
<td align="center">从字符串 off 位置开始截取 len 长度的字符串写入文件</td>
</tr>
<tr>
<td align="center">void flush()</td>
<td align="center">刷新此输出流并强制写出所有缓冲的输出字符</td>
</tr>
<tr>
<td align="center">void close()</td>
<td align="center">关闭文件输出流</td>
</tr>
</tbody></table>
<h3 id="5-PrintStream"><a href="#5-PrintStream" class="headerlink" title="5. PrintStream"></a>5. PrintStream</h3><p>标准的字节输出流。默认输出到控制台</p>
<h4 id="构造方法-4"><a href="#构造方法-4" class="headerlink" title="构造方法"></a>构造方法</h4><table>
<thead>
<tr>
<th align="center">构造方法名</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PrintStream(File file)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PrintStream(OutputStream out)</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">PrintStream(String fileName)</td>
<td align="center">fileName 文件地址</td>
</tr>
</tbody></table>
<h4 id="方法-4"><a href="#方法-4" class="headerlink" title="方法"></a>方法</h4><table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">println(参数类型不定 x)</td>
<td align="center">输出 x 带换行</td>
</tr>
<tr>
<td align="center">print(参数类型不定 x)</td>
<td align="center">输出 x 不带换行</td>
</tr>
<tr>
<td align="center">void flush()</td>
<td align="center">刷新此输出流并强制写出所有缓冲的输出字符</td>
</tr>
<tr>
<td align="center">void close()</td>
<td align="center">关闭流</td>
</tr>
</tbody></table>
<p><strong>改变流的输出方法</strong></p>
<p>System.setOut(PrintStream 对象)</p>
<p><strong>注意：</strong></p>
<ol>
<li>标准输出流不需要手动 close() 关闭</li>
<li>可以改变标准输出流的输出方向</li>
</ol>
<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><p>参与序列化和反序列化的对象，必须实现**<code>Serializable</code>** 接口。</p>
<h3 id="Serializable-接口起什么作用呢？"><a href="#Serializable-接口起什么作用呢？" class="headerlink" title="Serializable 接口起什么作用呢？"></a>Serializable 接口起什么作用呢？</h3><ul>
<li>起到 <strong><code>标识</code></strong> 的作用，标志的作用，java 虚拟机看到这个类实现了这个接口，可能会对这个类进行特殊待遇。</li>
<li>Serializable 这个标志接口是给 java 虚拟机参考的，java 虚拟机看到这个接口之后，会为该类自动生成一个序列化版本号。</li>
</ul>
<h3 id="序列化版本号有什么用"><a href="#序列化版本号有什么用" class="headerlink" title="序列化版本号有什么用"></a>序列化版本号有什么用</h3><p>区分两个类是否相同</p>
<h3 id="java-语言中是采用什么机制来区分类的"><a href="#java-语言中是采用什么机制来区分类的" class="headerlink" title="java 语言中是采用什么机制来区分类的"></a>java 语言中是采用什么机制来区分类的</h3><ol>
<li>首先通过 <strong><code>类名</code></strong> 进行比对，如果类名不一样，肯定不是同一个类。</li>
<li>如果类名一样，再怎么进行类的区别？靠 <strong><code>序列化版本号</code></strong> 进行区分。</li>
</ol>
<h3 id="这种自动生成序列化版本号有什么缺陷"><a href="#这种自动生成序列化版本号有什么缺陷" class="headerlink" title="这种自动生成序列化版本号有什么缺陷"></a>这种自动生成序列化版本号有什么缺陷</h3><p>Java 虚拟机看到 Serializable 接口之后，会<strong>自动生成</strong>一个序列化版本号。</p>
<p>这种自动生成的序列化版本号缺点是：一旦代码确定之后，<strong>不能进行后续的修改</strong>，因为只要修改，必然会重新编译，此时会生成全新的序列化版本号，这个时候 java 虚拟机会认为这是一个全新的类。（这样就不好了！）</p>
<h3 id="怎么使某个属性不序列化"><a href="#怎么使某个属性不序列化" class="headerlink" title="怎么使某个属性不序列化"></a>怎么使某个属性不序列化</h3><p>使用 <strong><code>transient</code></strong> 关键字</p>
<p>transient 关键字表示游离的，<strong>不参与序列化</strong>。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>凡是一个类实现了 Serializable 接口，建议给该类<strong>提供一个固定不变的序列化版本号</strong>。<br>这样，以后这个类即使代码修改了，但是版本号不变，java 虚拟机会认为是同一个类。</p>
<h1 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h1><h2 id="一、NIO-简介"><a href="#一、NIO-简介" class="headerlink" title="一、NIO 简介"></a>一、NIO 简介</h2><p>NIO 中的 N 可以理解为 Non-blocking，不单纯是 New，是解决高并发、I&#x2F;O 高性能的有效方式。</p>
<p>Java NIO 是 Java1.4 之后推出来的一套 IO 接口，NIO 提供了一种完全不同的操作方式， NIO 支持面向缓冲区的、基于通道的 IO 操作。</p>
<p>新增了许多用于处理输入输出的类，这些类都被放在 java.nio 包及子包下，并且对原 java.io 包中的很多类进行改写，新增了满足 NIO 的功能。</p>
<h2 id="二、NIO-和-BIO"><a href="#二、NIO-和-BIO" class="headerlink" title="二、NIO 和 BIO"></a>二、NIO 和 BIO</h2><h3 id="BIO"><a href="#BIO" class="headerlink" title="BIO"></a>BIO</h3><p>BIO 全称是 Blocking IO，同步阻塞式 IO，是 JDK1.4 之前的传统 IO 模型。</p>
<p>Java BIO：服务器实现模式为一个连接一个线程，即客户端有连接请求时服务器端就需要启动一个线程进行处理，如下图所示：</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021523910.webp" alt="img"></p>
<p>虽然此时服务器具备了高并发能力，即能够同时处理多个客户端请求了，但是却带来了一个问题，随着开启的线程数目增多，将会消耗过多的内存资源，导致服务器变慢甚至崩溃，NIO 可以一定程度解决这个问题。</p>
<h3 id="NIO-1"><a href="#NIO-1" class="headerlink" title="NIO"></a>NIO</h3><p>Java NIO： 同步非阻塞，服务器实现模式为一个线程处理多个请求 (连接)，即客户端发送的连接请求都会注册到多路复用器上，多路复用器轮询到连接有 I&#x2F;O 请求就进行处理。</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021523548.webp" alt="img"></p>
<p>一个线程中就可以调用多路复用接口（java 中是 select）阻塞同时监听来自多个客户端的 IO 请求，一旦有收到 IO 请求就调用对应函数处理，NIO 擅长 1 个线程管理多条连接，节约系统资源。</p>
<h2 id="三、NIO-的核心实现"><a href="#三、NIO-的核心实现" class="headerlink" title="三、NIO 的核心实现"></a>三、NIO 的核心实现</h2><p><strong>NIO 包含 3 个核心的组件：</strong></p>
<ul>
<li>Channel(通道)</li>
<li>Buffer(缓冲区)</li>
<li>Selector(选择器)</li>
</ul>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021523581.webp" alt="img"></p>
<h3 id="Channel-通道"><a href="#Channel-通道" class="headerlink" title="Channel(通道)"></a>Channel(通道)</h3><p>Channel 是 NIO 的核心概念，它表示一个打开的连接，这个连接可以连接到 I&#x2F;O 设备（例如：磁盘文件，Socket）或者一个支持 I&#x2F;O 访问的应用程序，Java NIO 使用缓冲区和通道来进行数据传输。</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021524396.webp" alt="img"></p>
<p>通道的主要实现类：</p>
<h4 id="FileChannel-类"><a href="#FileChannel-类" class="headerlink" title="FileChannel 类"></a>FileChannel 类</h4><p>本地文件 IO 通道，用于读取、写入、映射和操作文件的通道，使用文件通道操作文件的一半流程为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;D:\\a.txt&quot;</span>);</span><br><span class="line">    <span class="comment">//获取文件通道 获取时需要指定文件路径和文件打开方式</span></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">fileChannel</span> <span class="operator">=</span> FileChannel.open(Paths.get(file), StandardOpenOption.READ);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建字节缓冲区 分配字节缓存为 10 个字节</span></span><br><span class="line">    <span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">text</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (fileChannel.read(buf) != -<span class="number">1</span>)&#123; <span class="comment">//读取通道中的数据，并写入到 buf 中</span></span><br><span class="line">        buf.flip(); <span class="comment">//缓存区切换到读模式</span></span><br><span class="line">        <span class="keyword">while</span> (buf.position() &lt; buf.limit())&#123; <span class="comment">//读取 buf 中的数据</span></span><br><span class="line">            text.append((<span class="type">char</span>)buf.get());</span><br><span class="line">        &#125;</span><br><span class="line">        buf.clear(); <span class="comment">// 清空 buffer，缓存区切换到写模式</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    text.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> FileChannel.open(Paths.get(file), StandardOpenOption.APPEND);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写入数据</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; text.length(); i++)&#123;</span><br><span class="line">        buf.put((<span class="type">byte</span>) text.charAt(i));</span><br><span class="line">        <span class="keyword">if</span>(buf.position() == buf.limit() || i == text.length() - <span class="number">1</span>)&#123;</span><br><span class="line">            buf.flip(); <span class="comment">// 将缓存区由写模式置为读模式</span></span><br><span class="line">            channel.write(buf); <span class="comment">//将缓存区的数据写到通道</span></span><br><span class="line">            buf.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将数据刷出到物理磁盘，FileChannel 的 force(boolean metaData) 方法可以确保对文件的操作能够更新到磁盘</span></span><br><span class="line">    channel.force(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭通道</span></span><br><span class="line">    fileChannel.close();</span><br><span class="line">    channel.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SocketChannel-类"><a href="#SocketChannel-类" class="headerlink" title="SocketChannel 类"></a>SocketChannel 类</h4><p>网络套接字 IO 通道，TCP 协议，针对面向流的连接套接字的可选择通道（一般用在客户端）。</p>
<p>TCP 客户端使用 SocketChannel 与服务端进行交互的流程为：</p>
<ol>
<li>打开通道，连接到服务端</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SocketChannel</span> <span class="variable">channel</span> <span class="operator">=</span> SocketChannel.open(); <span class="comment">// 打开通道，此时还没有打开 TCP 连接</span></span><br><span class="line">channel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9090</span>)); <span class="comment">// 连接到服务端</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>分配缓冲区</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>); <span class="comment">// 分配一个 10 字节的缓冲区，不实用，容量太小</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置是否为阻塞方式。（默认为阻塞方式）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(<span class="literal">false</span>); <span class="comment">// 配置通道为非阻塞模式</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>与服务端进行数据交互</li>
<li>关闭连接</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.close();	<span class="comment">//关闭通道</span></span><br></pre></td></tr></table></figure>

<h4 id="ServerSocketChannel-类"><a href="#ServerSocketChannel-类" class="headerlink" title="ServerSocketChannel 类"></a>ServerSocketChannel 类</h4><p>网络通信 IO 操作，TCP 协议，针对面向流的监听套接字的可选择通道（一般用于服务端），流程如下：</p>
<ol>
<li>打开一个 ServerSocketChannel 通道, 绑定端口。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> ServerSocketChannel.open(); <span class="comment">// 打开通道</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>绑定端口</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">9090</span>)); <span class="comment">// 绑定端口</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>阻塞等待连接到来，有新连接时会创建一个 SocketChannel 通道，服务端可以通过这个通道与连接过来的客户端进行通信。等待连接到来的代码一般放在一个循环结构中。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> server.accept(); <span class="comment">// 阻塞，直到有连接过来</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>通过 SocketChannel 与客户端进行数据交互</li>
<li>关闭 SocketChannel</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.close();</span><br></pre></td></tr></table></figure>

<h3 id="Buffer-缓冲区"><a href="#Buffer-缓冲区" class="headerlink" title="Buffer(缓冲区)"></a>Buffer(缓冲区)</h3><p>缓冲区 Buffer 是 Java NIO 中一个核心概念，在 NIO 库中，所有数据都是用缓冲区处理的。</p>
<p>在读取数据时，它是直接读到缓冲区中的,在写入数据时，它也是写入到缓冲区中的,任何时候访问 NIO 中的数据，都是将它放到缓冲区中。</p>
<p>而在面向流 I&#x2F;O 系统中，所有数据都是直接写入或者直接将数据读取到 Stream 对象中。</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021524215.webp" alt="img"></p>
<h4 id="Buffer-数据类型"><a href="#Buffer-数据类型" class="headerlink" title="Buffer 数据类型"></a>Buffer 数据类型</h4><p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021524947.webp" alt="img"></p>
<p>从类图中可以看到，7 种数据类型对应着 7 种子类，这些名字是 Heap 开头子类，数据是存放在 JVM 堆中的。</p>
<h4 id="MappedByteBuffer"><a href="#MappedByteBuffer" class="headerlink" title="MappedByteBuffer"></a>MappedByteBuffer</h4><p>而 MappedByteBuffer 则是存放在堆外的直接内存中，可以映射到文件。</p>
<p>通过 java.nio 包和 MappedByteBuffer 允许 Java 程序直接从内存中读取文件内容，通过将整个或部分文件映射到内存，由操作系统来处理加载请求和写入文件，应用只需要和内存打交道，这使得 IO 操作非常快。</p>
<p>Mmap 内存映射和普通标准 IO 操作的本质区别在于它并不需要将文件中的数据先拷贝至 OS 的内核 IO 缓冲区，而是可以直接将用户进程私有地址空间中的一块区域与文件对象建立映射关系，这样程序就好像可以直接从内存中完成对文件读&#x2F;写操作一样。</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021524595.webp" alt="img"></p>
<p>只有当缺页中断发生时，直接将文件从磁盘拷贝至用户态的进程空间内，只进行了一次数据拷贝，对于容量较大的文件来说（文件大小一般需要限制在 1.5~2G 以下），采用 Mmap 的方式其读&#x2F;写的效率和性能都非常高，大家熟知的<a href="https://link.juejin.cn/?target=https://mikechen.cc/3476.html">RocketMQ</a> 就使用了该技术。</p>
<h4 id="Buffer-数据流程"><a href="#Buffer-数据流程" class="headerlink" title="Buffer 数据流程"></a>Buffer 数据流程</h4><p>应用程序可以通过与 I&#x2F;O 设备建立通道来实现对 I&#x2F;O 设备的读写操作，操作的数据通过缓冲区 Buffer 来进行交互。</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021524132.webp" alt="img"></p>
<p>从 I&#x2F;O 设备读取数据时：</p>
<ol>
<li>应用程序调用通道 Channel 的 read() 方法</li>
<li>通道往缓冲区 Buffer 中填入 I&#x2F;O 设备中的数据，填充完成之后返回</li>
<li>应用程序从缓冲区 Buffer 中获取数据</li>
</ol>
<p>往 I&#x2F;O 设置写数据时：</p>
<ol>
<li><p>应用程序往缓冲区 Buffer 中填入要写到 I&#x2F;O 设备中的数据</p>
</li>
<li><p>调用通道 Cannel 的 write() 方法，通道将数据传输至 I&#x2F;O 设备</p>
</li>
</ol>
<h4 id="缓冲区核心方法"><a href="#缓冲区核心方法" class="headerlink" title="缓冲区核心方法"></a>缓冲区核心方法</h4><p>缓冲区存取数据的两个核心方法：</p>
<ol>
<li>put()：存入数据到缓冲区<ul>
<li>put(byte b)：将给定单个字节写入缓冲区的当前位置</li>
<li>put(byte[] src)：将 src 中的字节写入缓冲区的当前位置</li>
<li>put(int index,byte b)：将指定字节写入缓冲区的索引位置 (不会移动 position)</li>
</ul>
</li>
<li>get()：获取缓冲区的数据<ul>
<li>get()：读取单个字节</li>
<li>get(byte[] dst)：批量读取多个字节到 dst 中</li>
<li>get(int index)：读取指定索引位置的字节 (不会移动 position)</li>
</ul>
</li>
</ol>
<h3 id="Selector-选择器"><a href="#Selector-选择器" class="headerlink" title="Selector(选择器)"></a>Selector(选择器)</h3><p>Selector 类是 NIO 的核心类，Selector（选择器）选择器提供了选择已经就绪的任务的能力。</p>
<p>Selector 会不断的轮询注册在上面的所有 channel，如果某个 channel 为读写等事件做好准备，那么就处于就绪状态，通过 Selector 可以不断轮询发现出就绪的 channel，进行后续的 IO 操作。</p>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021524858.webp" alt="img"></p>
<p>一个 Selector 能够同时轮询多个 channel，这样，一个单独的线程就可以管理多个 channel，从而管理多个网络连接，这样就不用为每一个连接都创建一个线程，同时也避免了多线程之间上下文切换导致的开销。</p>
<h4 id="选择器使用步骤"><a href="#选择器使用步骤" class="headerlink" title="选择器使用步骤"></a>选择器使用步骤</h4><ol>
<li><p>获取选择器</p>
<p>   与通道和缓冲区的获取类似，选择器的获取也是通过静态工厂方法 open() 来得到的。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open(); <span class="comment">// 获取一个选择器实例</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>获取可选择通道</p>
<p>   能够被选择器监控的通道必须实现了 SelectableChannel 接口，并且需要将通道配置成非阻塞模式，否则后续的注册步骤会抛出 IllegalBlockingModeException。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9090</span>)); <span class="comment">// 打开 SocketChannel 并连接到本机 9090 端口</span></span><br><span class="line">socketChannel.configureBlocking(<span class="literal">false</span>); <span class="comment">// 配置通道为非阻塞模式</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>将通道注册到选择器</p>
<p>   通道在被指定的选择器监控之前，应该先告诉选择器，并且告知监控的事件，即：将通道注册到选择器。</p>
<p>   通道的注册通过 SelectableChannel.register(Selector selector, int ops) 来完成，ops 表示关注的事件，如果需要关注该通道的多个 I&#x2F;O 事件，可以传入这些事件类型或运算之后的结果。这些事件必须是通道所支持的，否则抛出 IllegalArgumentException。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socketChannel.register(selector, SelectionKey.OP_READ | SelectionKey.OP_WRITE); <span class="comment">// 将套接字通过到注册到选择器，关注 read 和 write 事件</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>轮询 select 就绪事件</p>
<p>   通过调用选择器的 Selector.select() 方法可以获取就绪事件，该方法会将就绪事件放到一个 SelectionKey 集合中，然后返回就绪的事件的个数。这个方法映射多路复用 I&#x2F;O 模型中的 select 系统调用，它是一个阻塞方法。正常情况下，直到至少有一个就绪事件，或者其它线程调用了当前 Selector 对象的 wakeup() 方法，或者当前线程被中断时返回。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (selector.select() &gt; <span class="number">0</span>)&#123; <span class="comment">// 轮询，且返回时有就绪事件</span></span><br><span class="line">Set&lt;SelectionKey&gt; keys = selector.selectedKeys(); <span class="comment">// 获取就绪事件集合</span></span><br><span class="line">.......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>   有 3 种方式可以 select 就绪事件：

1. select() 阻塞方法，有一个就绪事件，或者其它线程调用了 wakeup() 或者当前线程被中断时返回。

2. select(long timeout) 阻塞方法，有一个就绪事件，或者其它线程调用了 wakeup()，或者当前线程被中断，或者阻塞时长达到了 timeout 时返回。不抛出超时异常。

3. selectNode() 不阻塞，如果无就绪事件，则返回 0；如果有就绪事件，则将就绪事件放到一个集合，返回就绪事件的数量。
</code></pre>
<ol start="5">
<li><p>处理就绪事件</p>
<p>   每次可以 select 出一批就绪的事件，所以需要对这些事件进行迭代</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(SelectionKey key : keys)&#123;</span><br><span class="line">    <span class="keyword">if</span>(key.isWritable())&#123; <span class="comment">// 可写事件</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;Bye&quot;</span>.equals( (line = scanner.nextLine()) ))&#123;</span><br><span class="line">            socketChannel.shutdownOutput();</span><br><span class="line">            socketChannel.close();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        buf.put(line.getBytes());</span><br><span class="line">        buf.flip();</span><br><span class="line">        socketChannel.write(buf);</span><br><span class="line">        buf.compact();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从一个 SelectionKey 对象可以得到：</p>
<ol>
<li>就绪事件的对应的通道；</li>
<li>就绪的事件。通过这些信息，就可以很方便地进行 I&#x2F;O 操作。</li>
</ol>
<h1 id="Java-实现文件上传，下载-理论，实践"><a href="#Java-实现文件上传，下载-理论，实践" class="headerlink" title="Java 实现文件上传，下载 (理论，实践)"></a>Java 实现文件上传，下载 (理论，实践)</h1><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8080</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">            executorService.execute(() -&gt; &#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">BufferedInputStream</span> <span class="variable">bufferedInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">BufferedOutputStream</span> <span class="variable">bufferedOutputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    inputStream = socket.getInputStream();</span><br><span class="line">                    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="keyword">while</span> ((i = inputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                        name = <span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, i);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;1&quot;</span>.equals(name)) &#123;</span><br><span class="line">                        filePath = <span class="string">&quot;D:/暂存文件/信封.txt&quot;</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;2&quot;</span>.equals(name)) &#123;</span><br><span class="line">                        filePath = <span class="string">&quot;D:/暂存文件/信封 1.txt&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    bufferedInputStream = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath));</span><br><span class="line">                    <span class="type">byte</span>[] run = Fuzhu.run(bufferedInputStream);</span><br><span class="line">                    outputStream = socket.getOutputStream();</span><br><span class="line">                    bufferedOutputStream = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(outputStream);</span><br><span class="line">                    bufferedOutputStream.write(run);</span><br><span class="line">                    bufferedOutputStream.flush();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (bufferedOutputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            bufferedOutputStream.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (outputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            outputStream.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (bufferedInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            bufferedInputStream.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                            inputStream.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span>(flag) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请选择 上传 或 下载操作&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;退出程序 x&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">x</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            <span class="keyword">switch</span> (x) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;下载&quot;</span>:</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Client</span>().downFile();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;上传&quot;</span>:</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Client</span>().upLoad();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;x&quot;</span>:</span><br><span class="line">                    flag = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    System.out.println(<span class="string">&quot;请选择可用项&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;程序已退出&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请选择你要下载的文件&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;1 -&gt; 信封.txt&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;2 -&gt; 信封 1.txt&quot;</span>);</span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">localHost</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BufferedOutputStream</span> <span class="variable">bufferedOutputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">BufferedInputStream</span> <span class="variable">bufferedInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            localHost = InetAddress.getLocalHost();</span><br><span class="line">            socket = <span class="keyword">new</span> <span class="title class_">Socket</span>(localHost.getHostAddress(), <span class="number">8080</span>);</span><br><span class="line">            outputStream = socket.getOutputStream();</span><br><span class="line">            <span class="type">String</span> <span class="variable">next</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">            outputStream.write(next.getBytes());</span><br><span class="line">            socket.shutdownOutput();</span><br><span class="line">            bufferedInputStream = <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(socket.getInputStream());</span><br><span class="line">            <span class="type">byte</span>[] run = Fuzhu.run(bufferedInputStream);</span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;D:/下载/&quot;</span> + next + <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">            bufferedOutputStream = <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filePath));</span><br><span class="line">            bufferedOutputStream.write(run);</span><br><span class="line">            bufferedOutputStream.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (bufferedOutputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                    bufferedOutputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (bufferedInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                    bufferedInputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (outputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">upLoad</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入文件名称&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入信封内容&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> scanner.next();</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/暂存文件&quot;</span> + name + <span class="string">&quot;.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileOutputStream = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">            fileOutputStream.write(content.getBytes());</span><br><span class="line">            fileOutputStream.flush();</span><br><span class="line">            System.out.println(<span class="string">&quot;上传完成&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fileOutputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                    fileOutputStream.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="传输工具类"><a href="#传输工具类" class="headerlink" title="传输工具类"></a>传输工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fuzhu</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] run(InputStream a) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">x</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((i = a.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            x.write(bytes, <span class="number">0</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] byteArray = x.toByteArray();</span><br><span class="line">        <span class="keyword">return</span> byteArray;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><h2 id="一、多线程三种调用方式"><a href="#一、多线程三种调用方式" class="headerlink" title="一、多线程三种调用方式"></a>一、多线程三种调用方式</h2><p>第一种方式：</p>
<p>编写一个类，直接继承**<code>java.long.Thread</code><strong>，重写</strong><code>run</code>方法**。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义线程类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        <span class="comment">//t.run(); // 不会启动线程，不会分配新的分支栈。（这种方式就是单线程。）</span></span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二种方式：</p>
<p>编写一个类，实现 <strong><code>java.lang.Runnable</code></strong> 接口，实现**<code>run 方法</code>**。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnble</span> <span class="keyword">implements</span> <span class="title class_">Runnble</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnble</span>);</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>采用匿名内部类创建：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建线程对象，采用匿名内部类方式。</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;t 线程---&gt; &quot;</span> + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动线程</span></span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main 线程---&gt; &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三种方式：</p>
<p>编写一个类，实现 <strong><code>java.util.concurrent.Callable</code></strong> 接口，实现**<code>call 方法</code>**。</p>
<p>call 方法具有返回值，Java5 使用 Future 接口来代表 call 方法的返回值，并且为 Future 接口提供了一个实现类 FutureTask<br>。FutureTask 既实现了 Future 接口又实现了 Runnable 接口。所以 FutureTask 可以作为 Thread 构造方法的参数传入来创建线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt;&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        Callable&lt;Integer&gt; callable = <span class="keyword">new</span> <span class="title class_">Mycallable</span>();</span><br><span class="line">        FutureTask&lt;Integer&gt; task = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line">        Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">        <span class="comment">//线程开始执行</span></span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这三种创建线程的区别：</p>
<ol>
<li><p>第二种创建线程的方式相比于第一种创建线程的优点</p>
<ul>
<li>更适合多线程实行相同任务，可以减少代码量</li>
<li>避免了单继承的局限性</li>
<li>线程和任务分离，提高了程序健壮性</li>
<li>线程池接受 Runnable 类型任务，不接受 Thread 类型线程</li>
</ul>
</li>
<li><p>第三种相比于前两种创建线程的区别：</p>
<p>使用 Callable 方式创建线程时，call 方法具有返回值。Future 封装了 call 方法的返回值，可以通过 FutureTask 的对象调用 Future 接口的一些方法来控制任务。如：V get（）：调用这个方法可以阻塞主线程直到子线程返回结果。等等。</p>
</li>
</ol>
<h2 id="二、多线程基本方法"><a href="#二、多线程基本方法" class="headerlink" title="二、多线程基本方法"></a>二、多线程基本方法</h2><table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">static Thread currentThread()</td>
<td align="center">获取当前线程对象</td>
</tr>
<tr>
<td align="center">String getName()</td>
<td align="center">获取线程对象名字</td>
</tr>
<tr>
<td align="center">void setName(String name)</td>
<td align="center">修改线程对象名字</td>
</tr>
<tr>
<td align="center">static void sleep(long millis)</td>
<td align="center">让当前线程休眠 millis 秒</td>
</tr>
<tr>
<td align="center">void interrupt()</td>
<td align="center">终止线程的睡眠</td>
</tr>
<tr>
<td align="center">void stop()</td>
<td align="center">强行终止一个线程的执行 (不推荐使用)<br /> 建议使用布尔标记来结束进程的执行</td>
</tr>
<tr>
<td align="center">int getPriority()</td>
<td align="center">获得线程优先级</td>
</tr>
<tr>
<td align="center">void setPriority(int newPriority)</td>
<td align="center">设置线程优先级</td>
</tr>
<tr>
<td align="center">static void yield()</td>
<td align="center">让位方法，当前线程暂停，回到就绪状态，让给其它线程。<br /> 注意：在回到就绪之后，有可能还会再次抢到。</td>
</tr>
<tr>
<td align="center">void join()</td>
<td align="center">将一个线程合并到当前线程中，当前线程受阻塞，加入的线程执行直到结束</td>
</tr>
<tr>
<td align="center">void setDaemon(boolean on)</td>
<td align="center">on 为 true 表示把线程设置为守护线程</td>
</tr>
</tbody></table>
<p>setPriority(int newPriority) 参数使用的常量:</p>
<table>
<thead>
<tr>
<th align="center">常量名</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">static int MAX_PRIORITY</td>
<td align="center">最高优先级（10）</td>
</tr>
<tr>
<td align="center">static int MIN_PRIORITY</td>
<td align="center">最低优先级（1）</td>
</tr>
<tr>
<td align="center">static int NORM_PRIORITY</td>
<td align="center">默认优先级（5）</td>
</tr>
</tbody></table>
<p>关于 Object 类的 wait()、notify()、notifyAll() 方法</p>
<table>
<thead>
<tr>
<th align="center">方法名</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">void wait()</td>
<td align="center">让活动在当前对象的线程无限等待（释放之前占有的锁）</td>
</tr>
<tr>
<td align="center">void notify()</td>
<td align="center">唤醒当前对象正在等待的线程（只提示唤醒，不会释放锁）</td>
</tr>
<tr>
<td align="center">void notifyAll()</td>
<td align="center">唤醒当前对象全部正在等待的线程（只提示唤醒，不会释放锁）</td>
</tr>
</tbody></table>
<p>wait 和 notify 方法<strong>不是线程对象的方法</strong>，是 java 中任何一个 java 对象都有的方法，因为这两个方法是 <strong><code>Object 类中自带</code></strong> 的。</p>
<p><strong>wait 方法和 notify 方法不是通过线程对象调用</strong></p>
<p>作用：</p>
<p>对应<strong>生产消费者模式</strong></p>
<p><strong>什么是生产消费者模式</strong></p>
<ul>
<li>生产线程负责生产，消费线程负责消费。</li>
<li>生产线程和消费线程要达到均衡。</li>
<li>这是一种特殊的业务需求，在这种特殊的情况下需要使用<strong>wait 方法和 notify 方法</strong>。</li>
</ul>
<h2 id="三、死锁"><a href="#三、死锁" class="headerlink" title="三、死锁"></a>三、死锁</h2><h3 id="什么是死锁"><a href="#什么是死锁" class="headerlink" title="什么是死锁"></a>什么是死锁</h3><p><strong>死锁 是指两个或两个以上的进程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。</strong>也就是两个线程拥有锁的情况下，又在尝试获取对方的锁，从而造成程序一直阻塞的情况。</p>
<p>死锁代码演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// 1.占有一把锁</span></span><br><span class="line">            <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 1 获得锁 A&quot;</span>);</span><br><span class="line">                <span class="comment">// 休眠 1s（让线程 2 有时间先占有锁 B）</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 获取线程 2 的锁 B</span></span><br><span class="line">                <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;线程 1 获得锁 B&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t1.start();</span><br><span class="line"> </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// 占 B 锁</span></span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 2 获得锁 B&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 获取线程 1 的锁 A</span></span><br><span class="line">                <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;线程 2 获得了锁 A&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="死锁产生的原因"><a href="#死锁产生的原因" class="headerlink" title="死锁产生的原因"></a>死锁产生的原因</h3><p>形成死锁主要由以下 4 个因素造成的：</p>
<ol>
<li>互斥条件：一个资源只能只能被⼀个线程占有，当这个资源被占用之后其他线程就只能等待。</li>
<li>不可被剥夺条件：当⼀个线程不主动释放资源时，此资源一直被拥有线程占有。</li>
<li>请求并持有条件：线程已经拥有了⼀个资源之后，还不满足，又尝试请求新的资源。</li>
<li>环路等待条件：多个线程在请求资源的情况下，形成了环路链。</li>
</ol>
<h3 id="如何解决死锁问题"><a href="#如何解决死锁问题" class="headerlink" title="如何解决死锁问题"></a>如何解决死锁问题</h3><p>改变产生死锁原因中的任意⼀个或多个条件就可以解决死锁的问题，其中可以被修改的条件只有两个：<strong>请求并持有条件</strong> 和 <strong>环路等待条件</strong>。 </p>
<h4 id="改变环路等待条件"><a href="#改变环路等待条件" class="headerlink" title="改变环路等待条件"></a>改变环路等待条件</h4><p>通过修改获取锁的有序性来改变环路等待条件，修改代码如下： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnDeadLock2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 1 得到锁 A&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;线程 1 得到锁 B&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;线程 1 释放锁 B&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 1 释放锁 A&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;线程 1&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"> </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 2 得到锁 A&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;线程 2 得到锁 B&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;线程 2 释放锁 B&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 2 释放锁 A&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;线程 2&quot;</span>);</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="破坏请求并持有条件"><a href="#破坏请求并持有条件" class="headerlink" title="破坏请求并持有条件"></a>破坏请求并持有条件</h4><p>可以通过破坏请求并持有条件解决死锁，修改代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnDeadLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"> </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 1 得到锁 A&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                synchronized (lockB) &#123;</span></span><br><span class="line"><span class="comment">//                    System.out.println(&quot;线程 1 得到锁 B&quot;);</span></span><br><span class="line"><span class="comment">//                    System.out.println(&quot;线程 1 释放锁 B&quot;);</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line">                System.out.println(<span class="string">&quot;线程 1 释放锁 A&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;线程 1&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"> </span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;线程 2 得到锁 B&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                synchronized (lockA) &#123;</span></span><br><span class="line"><span class="comment">//                    System.out.println(&quot;线程 2 得到锁 A&quot;);</span></span><br><span class="line"><span class="comment">//                    System.out.println(&quot;线程 2 释放锁 A&quot;);</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line">                System.out.println(<span class="string">&quot;线程 2 释放锁 B&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;线程 2&quot;</span>);</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h1><h2 id="一、何为-Base64-算法"><a href="#一、何为-Base64-算法" class="headerlink" title="一、何为 Base64 算法"></a>一、何为 Base64 算法</h2><p><strong>Base64</strong>是一种基于 64 个可打印字符来表示二进制数据的表示方法。由于 2 的 6 次方等于 64，所以每 6 个比特为一个单元，对应某个可打印字符。3 个字节有 24 个比特，对应于 4 个 Base64 单元，即 3 个字节可由 4 个可打印字符来表示。它可用来作为电子邮件的传输编码。在 Base64 中的可打印字符包括字母<code>A-Z</code>、<code>a-z</code>、数字<code>0-9</code>，这样共有 62 个字符，此外两个可打印符号在不同的系统中而不同。</p>
<p>Base64 常用于在通常处理文本数据的场合，表示、传输、存储一些二进制数据，包括 MIME 的电子邮件及 XML 的一些复杂数据。</p>
<h2 id="二、Base64-算法是如何设计的"><a href="#二、Base64-算法是如何设计的" class="headerlink" title="二、Base64 算法是如何设计的"></a>二、Base64 算法是如何设计的</h2><p>在不同的实现中，Base64 算法中由 64 个字符组成的字符集是不一样的。但是通常的实现方法是选择 64 个通用且能打印的字符来组成这样一个集合。且要保证这个集合中的每个字符组成的数据在数据传输系统中不会被修改。</p>
<p>早期的 Base64 算法是用来实现运行相同操作系统之间进行拨号操作而创建的。</p>
<p>让我们先来看一下最通常的 Base64 索引表：</p>
<table>
<thead>
<tr>
<th align="center">索引</th>
<th align="center">对应字符</th>
<th align="center">索引</th>
<th align="center">对应字符</th>
<th align="center">索引</th>
<th align="center">对应字符</th>
<th align="center">索引</th>
<th align="center">对应字符</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">A</td>
<td align="center">16</td>
<td align="center">Q</td>
<td align="center">32</td>
<td align="center">g</td>
<td align="center">48</td>
<td align="center">w</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">B</td>
<td align="center">17</td>
<td align="center">R</td>
<td align="center">33</td>
<td align="center">h</td>
<td align="center">49</td>
<td align="center">x</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">C</td>
<td align="center">18</td>
<td align="center">S</td>
<td align="center">34</td>
<td align="center">i</td>
<td align="center">50</td>
<td align="center">y</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">D</td>
<td align="center">19</td>
<td align="center">T</td>
<td align="center">35</td>
<td align="center">j</td>
<td align="center">51</td>
<td align="center">z</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">E</td>
<td align="center">20</td>
<td align="center">U</td>
<td align="center">36</td>
<td align="center">k</td>
<td align="center">52</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">F</td>
<td align="center">21</td>
<td align="center">V</td>
<td align="center">37</td>
<td align="center">l</td>
<td align="center">53</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">G</td>
<td align="center">22</td>
<td align="center">W</td>
<td align="center">38</td>
<td align="center">m</td>
<td align="center">54</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">H</td>
<td align="center">23</td>
<td align="center">X</td>
<td align="center">39</td>
<td align="center">n</td>
<td align="center">55</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">I</td>
<td align="center">24</td>
<td align="center">Y</td>
<td align="center">40</td>
<td align="center">o</td>
<td align="center">56</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">J</td>
<td align="center">25</td>
<td align="center">Z</td>
<td align="center">41</td>
<td align="center">p</td>
<td align="center">57</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">K</td>
<td align="center">26</td>
<td align="center">a</td>
<td align="center">42</td>
<td align="center">q</td>
<td align="center">58</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">L</td>
<td align="center">27</td>
<td align="center">b</td>
<td align="center">43</td>
<td align="center">r</td>
<td align="center">59</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">M</td>
<td align="center">28</td>
<td align="center">c</td>
<td align="center">44</td>
<td align="center">s</td>
<td align="center">60</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">N</td>
<td align="center">29</td>
<td align="center">d</td>
<td align="center">45</td>
<td align="center">t</td>
<td align="center">61</td>
<td align="center">9</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">O</td>
<td align="center">30</td>
<td align="center">e</td>
<td align="center">46</td>
<td align="center">u</td>
<td align="center">62</td>
<td align="center">+</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">P</td>
<td align="center">31</td>
<td align="center">f</td>
<td align="center">47</td>
<td align="center">v</td>
<td align="center">63</td>
<td align="center">&#x2F;</td>
</tr>
</tbody></table>
<h2 id="三、Base64-如何转换"><a href="#三、Base64-如何转换" class="headerlink" title="三、Base64 如何转换"></a>三、Base64 如何转换</h2><ol>
<li>把 3 个字节变成 4 个字节</li>
<li>每 76 哥字符加一个换行符</li>
<li>最后的结束符也要处理</li>
</ol>
<p>例如：<br>   转换前 11111111, 11111111, 11111111 （二进制）</p>
<p>   转换后 00111111, 00111111, 00111111, 00111111 （二进制）</p>
<p>   上面的三个字节是原文，下面的四个字节是转换后的 Base64 编码，其前两位均为 0。</p>
<p>   转换后，通过上面的码表来得到想要的字符串</p>
<h1 id="Lambda-表达式"><a href="#Lambda-表达式" class="headerlink" title="Lambda 表达式"></a>Lambda 表达式</h1><h2 id="一、为什么要使用-Lambda-表达式"><a href="#一、为什么要使用-Lambda-表达式" class="headerlink" title="一、为什么要使用 Lambda 表达式"></a>一、为什么要使用 Lambda 表达式</h2><p>Lambda 表达式就是为了使得我们的代码更加的简洁。如何简洁呢？我们直接举个例子来看看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaTest1</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//第一种</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;不使用 Lambda 表达式&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        runnable.run();</span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&quot;</span>);</span><br><span class="line">        <span class="comment">//第二种</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable1</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;使用 Lambda 表达式&quot;</span>);</span><br><span class="line">        runnable1.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之前我们新建一个线程使用 5 行代码，但是如果我们使用 lambda 表达式只需要 1 行代码即可。</p>
<h2 id="二、Lambda-表达式的使用"><a href="#二、Lambda-表达式的使用" class="headerlink" title="二、Lambda 表达式的使用"></a>二、Lambda 表达式的使用</h2><h3 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="1.基本语法"></a>1.基本语法</h3><p>在上面的例子中我们使用了这样一行 () -&gt; System.out.println(“使用 Lambda 表达式”);下面我们对 lambda 的格式进行一个介绍：</p>
<ul>
<li>左边括号：lambda 的形参列表，就好比是我们定义一个接口，里面有一个抽象方法，这个抽象方法的形参列表。</li>
<li>箭头：lambda 的操作符，所以你看见这个箭头心中知道这是一个 lambda 表达式就可以了。</li>
<li>右边 lambda 体：就好比是我们实现了接口中的抽象方法。</li>
</ul>
<p>lambda 表达式的使用可以分为以下 5 种基本的情况。我们一个一个来介绍。</p>
<h3 id="2-无参无返回值"><a href="#2-无参无返回值" class="headerlink" title="2. 无参无返回值"></a>2. 无参无返回值</h3><p>这个是最简单的一种情况，就是刚刚我们所举的例子。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此时如果方法体比较复杂是多行代码，那么这个 &#123;&#125; 是不能省略的</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">runnable1</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;使用 Lambda 表达式&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;使用 Lambda 表达式&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们可以看到没有任何参数也没有任何返回值，因此可以直接写，不过 lambda 体如果不是一行代码，那么就需要使用 {} 将其括起来。</p>
<h3 id="3-有参数无返回值"><a href="#3-有参数无返回值" class="headerlink" title="3.有参数无返回值"></a>3.有参数无返回值</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//第一种：没有使用 lambda 表达式</span></span><br><span class="line">    Consumer&lt;String&gt; consumer = <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    consumer.accept(<span class="string">&quot;没有使用 lambda:有参数，但是没有返回值&quot;</span>);</span><br><span class="line">    <span class="comment">//第二种：使用 lambda 表达式</span></span><br><span class="line">    Consumer&lt;String&gt; consumer1 = (String s)-&gt;&#123;</span><br><span class="line">        <span class="comment">//此时只有一行输出代码，因此可以省去外部的 &#123;&#125;</span></span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;;</span><br><span class="line">    consumer.accept(<span class="string">&quot;使用 lambda:有参数，但是没有返回值&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-有参数无返回值，数据类型可省略，称为类型推断"><a href="#4-有参数无返回值，数据类型可省略，称为类型推断" class="headerlink" title="4.有参数无返回值，数据类型可省略，称为类型推断"></a>4.有参数无返回值，数据类型可省略，称为类型推断</h3><p>这种情况只能称之为上面的一种特例，只不过我们可以不传入类型，由编译器帮我们推断出来即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Consumer&lt;String&gt; consumer1 = (s)-&gt;&#123;</span><br><span class="line">      <span class="comment">//此时只有一行输出代码，因此可以省去外部的 &#123;&#125;</span></span><br><span class="line">      System.out.println(s);</span><br><span class="line">&#125;;</span><br><span class="line">consumer.accept(<span class="string">&quot;使用 lambda:有参数，但是没有返回值&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>在这个例子中我们可以看到，直接把 s 中的 String 类型给去掉了，此时运行依然是正确的。这就是编译器自动为我们推断出了 s 的类型就是 String 的。只有一个参数是可以将小括号去除</p>
<h3 id="5-有多个参数，有返回值"><a href="#5-有多个参数，有返回值" class="headerlink" title="5.有多个参数，有返回值"></a>5.有多个参数，有返回值</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//第一种：没有使用 lambda 表达式</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator = <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;o1:&quot;</span>+o1);</span><br><span class="line">            <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(comparator.compare(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;======================&quot;</span>);</span><br><span class="line">    <span class="comment">//第二种：使用 lambda 表达式</span></span><br><span class="line">    Comparator&lt;Integer&gt; comparator2 = (o1,o2)-&gt;&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;o1:&quot;</span>+o1);</span><br><span class="line">        <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">    &#125;;</span><br><span class="line">    System.out.println(comparator2.compare(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们使用了一个比较器，当然了如果只有一条 return 语句的话，那样式就更简单了。箭头直接指向我们要返回的结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Comparator&lt;Integer&gt; comparator2 = (o1,o2)-&gt; o1.compareTo(o2);</span><br><span class="line">System.out.println(comparator2.compare(<span class="number">1</span>,<span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h2 id="三、Lambda-表达式深入解析"><a href="#三、Lambda-表达式深入解析" class="headerlink" title="三、Lambda 表达式深入解析"></a>三、<strong>Lambda 表达式深入解析</strong></h2><p>想要对 lambda 表达式有一个深入的理解，我们需要去认识另外一个知识点，那就是函数式接口。在上面我们的举得例子中比如 Consumer 或者是 Comparator 为什么能够使用 lambda 呢？就是因为实函数式接口，下面我们来认识一下：</p>
<h3 id="1-什么是函数式接口"><a href="#1-什么是函数式接口" class="headerlink" title="1.什么是函数式接口"></a>1.什么是函数式接口</h3><p>比如我们的 Runnable 就是一个函数式接口，我们可以到源码中看看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * When an object implementing interface &lt;code&gt;Runnable&lt;/code&gt; is used</span></span><br><span class="line"><span class="comment">     * to create a thread, starting the thread causes the object&#x27;s</span></span><br><span class="line"><span class="comment">     * &lt;code&gt;run&lt;/code&gt; method to be called in that separately executing</span></span><br><span class="line"><span class="comment">     * thread.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * The general contract of the method &lt;code&gt;run&lt;/code&gt; is that it may</span></span><br><span class="line"><span class="comment">     * take any action whatsoever.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span>     java.lang.Thread#run()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>他主要有如下的特点：</p>
<ol>
<li><strong>含有@FunctionalInterface 注解</strong></li>
<li><strong>只有一个抽象方法</strong></li>
</ol>
<p><strong>也就是说只有函数式接口的变量或者是函数式接口，才能够赋值为 Lambda 表达式。</strong>当然了方法的类型可以任意。</p>
<h3 id="2-函数式接口有什么用"><a href="#2-函数式接口有什么用" class="headerlink" title="2.函数式接口有什么用"></a>2.函数式接口有什么用</h3><p>函数式接口能够接受匿名内部类的实例化对象，换句话说，我们可以使用匿名内部类来实例化函数式接口的对象，而 Lambda 表达式能够代替内部类实现代码的进一步简化。并且 java 为我们提供了四个比较重要的函数式接口：</p>
<ol>
<li>消费型接口：Consumer&lt; T&gt; void accept(T t) 有参数，无返回值的抽象方法；</li>
<li>供给型接口：Supplier &lt; T&gt; T get() 无参有返回值的抽象方法；</li>
<li>断定型接口： Predicate&lt; T&gt; boolean test(T t):有参，但是返回值类型是固定的 boolean</li>
<li>函数型接口： Function&lt; T，R&gt; R apply(T t) 有参有返回值的抽象方法；</li>
</ol>
<p>这里仅仅是给出了 4 个，其实 java 提供了很多。比如 java.util.function 包下还有很多函数式接口可供使用。</p>
<h3 id="3-自定义一个函数式接口"><a href="#3-自定义一个函数式接口" class="headerlink" title="3.自定义一个函数式接口"></a>3.自定义一个函数式接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">interface</span> <span class="title class_">MyInterface</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyInterface</span> <span class="variable">myInterface</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;test&quot;</span>)；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们定义了一个 MyInterface 的函数式接口，里面定义了一个 test 方法，如果我们定义了两个就不能使用 lambda 表达式了，为什么呢？因为 lambda 是一个接口方法，如果有两个方法，应该指定哪一个呢？就搞混了。</p>
<h3 id="4-类型推导"><a href="#4-类型推导" class="headerlink" title="4.类型推导"></a>4.类型推导</h3><p>在第二部分介绍 lambda 语法的时候曾经说过，lambda 本身具有类型推导，那么这个类型推导可以做到什么程度呢？编译器负责推导 lambda 的类型，它利用上下文<strong>被期待的类型</strong>当做推导的目标类型，当满足下面条件时，就会被赋予目标类型：</p>
<ol>
<li>被期待的目标类型是一个函数式接口</li>
<li>lambad 的入参类型和数量与该接口一致</li>
<li>返回类型一致</li>
<li>抛出异常类型一致</li>
</ol>
<p>其实<strong>lambda 最后会由编译器生成 static 方法在当前类中，利用了 invokedynamic 命令脱离了内部类实现的优化。</strong></p>
<h1 id="Stream-流"><a href="#Stream-流" class="headerlink" title="Stream 流"></a>Stream 流</h1><p>Stream 操作的三个步骤</p>
<ul>
<li>创建 stream</li>
<li>中间操作 (过滤、map)</li>
<li>终止操作</li>
</ul>
<h2 id="一、Stream-流的格式"><a href="#一、Stream-流的格式" class="headerlink" title="一、Stream 流的格式"></a>一、Stream 流的格式</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;T&gt; <span class="title function_">filter</span><span class="params">(Predicate&lt;? <span class="built_in">super</span> T&gt; predicate)</span>;</span><br><span class="line">            -----&gt; 参数：<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Predicate</span>&lt;T&gt;  (函数式接口)</span><br><span class="line">                    ----&gt; 抽象方法：<span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>;</span><br><span class="line">            -----&gt; 参数：<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Consumer</span>&lt;T&gt;  (函数式接口)</span><br><span class="line">                    ----&gt; 抽象方法：<span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="二、获取流"><a href="#二、获取流" class="headerlink" title="二、获取流"></a>二、获取流</h2><p>根据集合来获取：</p>
<pre><code>根据 Collection 获取流：
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title function_">stream</span><span class="params">()</span></span><br></pre></td></tr></table></figure>

<ol>
<li>根据 List 获取流</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 List 集合</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="string">&quot;张老三&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;张小三&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;赵五&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;张六&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;王八&quot;</span>);</span><br><span class="line">Stream&lt;String&gt; stream1 = list.stream();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>根据 Set 集合获取流</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 List 集合</span></span><br><span class="line">   Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">   set.add(<span class="string">&quot;张老三&quot;</span>);</span><br><span class="line">   set.add(<span class="string">&quot;张小三&quot;</span>);</span><br><span class="line">   set.add(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">   set.add(<span class="string">&quot;赵五&quot;</span>);</span><br><span class="line">   set.add(<span class="string">&quot;张六&quot;</span>);</span><br><span class="line">   set.add(<span class="string">&quot;王八&quot;</span>);</span><br><span class="line">   Stream&lt;String&gt; stream2 = set.stream();</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>根据 Map 集合获取流</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Map 集合</span></span><br><span class="line">Map&lt;Integer,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="number">1</span>,<span class="string">&quot;张老三&quot;</span>);</span><br><span class="line">map.put(<span class="number">2</span>,<span class="string">&quot;张小三&quot;</span>);</span><br><span class="line">map.put(<span class="number">3</span>,<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">map.put(<span class="number">4</span>,<span class="string">&quot;赵五&quot;</span>);</span><br><span class="line">map.put(<span class="number">5</span>,<span class="string">&quot;张六&quot;</span>);</span><br><span class="line">map.put(<span class="number">6</span>,<span class="string">&quot;王八&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.1 根据 Map 集合的键获取流</span></span><br><span class="line">Set&lt;Integer&gt; map1 = map.keySet();</span><br><span class="line">Stream&lt;Integer&gt; stream3 = map1.stream();</span><br><span class="line"><span class="comment">// 3.2 根据 Map 集合的值获取流</span></span><br><span class="line">Collection&lt;String&gt; map2 = map.values();</span><br><span class="line">Stream&lt;String&gt; stream4 = map2.stream();</span><br><span class="line"><span class="comment">// 3.3 根据 Map 集合的键值对对象获取瑞</span></span><br><span class="line">Set&lt;Map.Entry&lt;Integer, String&gt;&gt; map3 = map.entrySet();</span><br><span class="line">Stream&lt;Map.Entry&lt;Integer, String&gt;&gt; stream5 = map3.stream();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>根据数组获取流</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据数组获取流</span></span><br><span class="line">   String[] arr = &#123;<span class="string">&quot;张颜宇&quot;</span>,<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;赵五&quot;</span>,<span class="string">&quot;刘六&quot;</span>,<span class="string">&quot;王七&quot;</span>&#125;;</span><br><span class="line">   Stream&lt;String&gt; stream6 = Stream.of(arr);</span><br></pre></td></tr></table></figure>

<h2 id="三、Stream-流的常用方法"><a href="#三、Stream-流的常用方法" class="headerlink" title="三、Stream 流的常用方法"></a>三、Stream 流的常用方法</h2><p>Stream 流的常用方法：</p>
<pre><code>终结方法：返回值类型不再是 Stream 接口本身类型的方法，例如：forEach() 方法和 count 方法

非终结方法/延迟方法：返回值类型仍然是 Stream 接口自身类型的方法，除了终结方法都是延迟方法。例如：filter,limit,skip,map,conat
</code></pre>
<table>
<thead>
<tr>
<th align="center">方法名称</th>
<th align="center">方法作用</th>
<th align="center">方法种类</th>
<th align="center">是否支持链式调用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">count</td>
<td align="center">统计个数</td>
<td align="center">终结方法</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">forEach</td>
<td align="center">逐一处理</td>
<td align="center">终结方法</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">filter</td>
<td align="center">过滤</td>
<td align="center">函数拼接</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">limit</td>
<td align="center">取用前几个</td>
<td align="center">函数拼接</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">skip</td>
<td align="center">跳过前几个</td>
<td align="center">函数拼接</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">map</td>
<td align="center">映射</td>
<td align="center">函数拼接</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">cocat</td>
<td align="center">组合 合并两个流</td>
<td align="center">函数拼接</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">distinct</td>
<td align="center">去重</td>
<td align="center">函数拼接</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">anyMatch</td>
<td align="center">只要有一个元素匹配传入的条件，就返回 true。</td>
<td align="center">终结方法</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">allMatch</td>
<td align="center">只要有一个元素不匹配传入的条件，就返回 false；<br /> 如果全部匹配，则返回 true。</td>
<td align="center">终结方法</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">noneMatch</td>
<td align="center">只要有一个元素匹配传入的条件，就返回 false；<br /> 如果全部不匹配，则返回 true。</td>
<td align="center">终结方法</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">collect</td>
<td align="center">收集</td>
<td align="center">终结方法</td>
<td align="center">否</td>
</tr>
</tbody></table>
<h2 id="四、收集-Stream-流"><a href="#四、收集-Stream-流" class="headerlink" title="四、收集 Stream 流"></a>四、收集 Stream 流</h2><h3 id="收集-Stream-流中的结果到集合"><a href="#收集-Stream-流中的结果到集合" class="headerlink" title="收集 Stream 流中的结果到集合"></a>收集 Stream 流中的结果到集合</h3><p>Stream 流提供 collect 方法，其参数需要一个 java.util.stream.Collector&lt;T,A,R&gt; 接口对象来指定收集到哪种集合中。java.util.stream.Collectors 类提供了一些方法，可以作为 Collector 接口的实例，最常用的就是静态方法 toList 与 toSet</p>
<ol>
<li>收集到 List 集合——toList</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">	Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;王五&quot;</span>, <span class="string">&quot;赵六&quot;</span>);</span><br><span class="line">	List&lt;String&gt; list = stream.collect(Collectors.toList());</span><br><span class="line">	System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>收集到 Set 集合——toSet</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span>&#123;</span><br><span class="line">	Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;王五&quot;</span>, <span class="string">&quot;赵六&quot;</span>);</span><br><span class="line">    Set&lt;String&gt; set = stream.collect(Collectors.toSet());</span><br><span class="line">    System.out.println(set);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>收集到指定集合</p>
<p> 例如：收集到 ArrayList 集合中</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testArrayList</span><span class="params">()</span>&#123;</span><br><span class="line">	Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;王五&quot;</span>, <span class="string">&quot;赵六&quot;</span>);</span><br><span class="line">	ArrayList&lt;String&gt; arrayList = stream.collect(Collectors.toCollection(ArrayList::<span class="keyword">new</span>));</span><br><span class="line">	System.out.println(arrayList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收集集合中的数据到数组中"><a href="#收集集合中的数据到数组中" class="headerlink" title="收集集合中的数据到数组中"></a>收集集合中的数据到数组中</h3><ol>
<li>转成 Object 数组——toArray</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2Array</span><span class="params">()</span>&#123;</span><br><span class="line">	Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;王五&quot;</span>, <span class="string">&quot;赵六&quot;</span>);</span><br><span class="line">	Object[] array = stream.toArray();</span><br><span class="line">	<span class="keyword">for</span>(Object o : array)&#123;</span><br><span class="line">	    System.out.println(o);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该方式转成 Object 类型的数组，我们操作起来不是很方便</p>
<ol start="2">
<li><p>转成指定类型的数组——toArray</p>
<p> 例如：将 String 流转成 String 数组</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2Array1</span><span class="params">()</span>&#123;</span><br><span class="line">	Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;王五&quot;</span>, <span class="string">&quot;赵六&quot;</span>);</span><br><span class="line">	String[] array = stream.toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">	<span class="keyword">for</span>(String str : array)&#123;</span><br><span class="line">	    System.out.println(<span class="string">&quot;元素是：&quot;</span> + str + <span class="string">&quot;  元素长度是：&quot;</span> + str.length());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对流中的数据的操作"><a href="#对流中的数据的操作" class="headerlink" title="对流中的数据的操作"></a>对流中的数据的操作</h3><ol>
<li><p>对流中的数据进行聚合计算<br>当我们使用 Stream 流处理数据后，可以像数据库聚合函数一样，对某个字段进行处理，比如，获取最大值，获取最小值，求总和，平均值，统计数量等。</p>
<ol>
<li>获取最大值——Collectors.maxBy</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCollectTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Student&gt; stream = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">21</span>, <span class="number">97D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">88D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">20</span>, <span class="number">62D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">18</span>, <span class="number">59D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">24</span>, <span class="number">100D</span>)</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 查找分数最大的 student</span></span><br><span class="line">        Optional&lt;Student&gt; optionalStudent = stream.collect(Collectors.maxBy((s1, s2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> s1.getScore() - s2.getScore() &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> optionalStudent.get();</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>获取最小值——Collectors.minBy</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCollectTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Student&gt; stream = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">21</span>, <span class="number">97D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">88D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">20</span>, <span class="number">62D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">18</span>, <span class="number">59D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">24</span>, <span class="number">100D</span>)</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 查找分数最小的 student</span></span><br><span class="line">        Optional&lt;Student&gt; optionalStudent = stream.collect(Collectors.minBy((s1, s2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> s1.getScore() - s2.getScore() &gt; <span class="number">0</span> ? <span class="number">1</span> : -<span class="number">1</span>;</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> optionalStudent.get();</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>求和——Collectors.summingDouble</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求所有分数之和</span></span><br><span class="line"><span class="type">Double</span> <span class="variable">aDouble</span> <span class="operator">=</span> stream.collect(Collectors.summingDouble(Student::getScore));</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>求平均值——Collectors.averagingDouble</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求分数的平均值</span></span><br><span class="line"><span class="type">Double</span> <span class="variable">aDouble</span> <span class="operator">=</span> stream.collect(Collectors.averagingDouble(Student::getScore));</span><br><span class="line">System.out.println(aDouble);</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>统计数量——Collection.counting</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求流中一共有多少个数据</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">aLong</span> <span class="operator">=</span> stream.collect(Collectors.counting());</span><br><span class="line">System.out.println(aLong);</span><br></pre></td></tr></table></figure>
</li>
<li><p>对流中的数据进行分组<br>当我们使用 Stream 流处理数据后，可以根据某个属性将数据分组</p>
<ol>
<li>简单的分组——Collectors.groupingBy<br>方法定义：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T, K&gt; Collector&lt;T, ?, Map&lt;K, List&lt;T&gt;&gt;&gt; groupingBy(Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">K</span>&gt; classifier) &#123;</span><br><span class="line">   <span class="keyword">return</span> groupingBy(classifier, toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code> 例如：按年龄分组
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCollectTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Student&gt; stream = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">21</span>, <span class="number">97D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">21</span>, <span class="number">88D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">24</span>, <span class="number">62D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">18</span>, <span class="number">59D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">24</span>, <span class="number">100D</span>)</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 根据年龄将数据分组</span></span><br><span class="line">        Map&lt;Integer, List&lt;Student&gt;&gt; collect = stream.collect(Collectors.groupingBy(Student::getAge));</span><br><span class="line">        collect.forEach((k,v)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;key:&quot;</span> + k + <span class="string">&quot;  value = &quot;</span> + v);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>多级分组——Collectors.groupingBy<br>使用 Collectors.groupingBy 的重载函数，方法定义</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T, K, A, D&gt; Collector&lt;T, ?, Map&lt;K, D&gt;&gt; groupingBy(Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">K</span>&gt; classifier,Collector&lt;? <span class="built_in">super</span> T, A, D&gt; downstream) &#123;</span><br><span class="line">   <span class="keyword">return</span> groupingBy(classifier, HashMap::<span class="keyword">new</span>, downstream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<pre><code>  例如：
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCollectTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Student&gt; stream = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">21</span>, <span class="number">97D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">21</span>, <span class="number">88D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">24</span>, <span class="number">62D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">18</span>, <span class="number">59D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">24</span>, <span class="number">100D</span>)</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 先根据年龄分组，在根据分数分组</span></span><br><span class="line">        Map&lt;Integer, Map&lt;String, List&lt;Student&gt;&gt;&gt; collect = stream.collect(Collectors.groupingBy(Student::getAge, Collectors.groupingBy(s -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (s.getScore() &gt; <span class="number">80</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;优秀&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;一般&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)));</span><br><span class="line">        collect.forEach((k,v)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;age:&quot;</span> + k);</span><br><span class="line">            v.forEach((k1,v1)-&gt;&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;\t&quot;</span> + <span class="string">&quot;k1:&quot;</span> + k1 + <span class="string">&quot;  v1:&quot;</span> + v1);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>对流中的数据进行分区——Collectors.partitioningBy<br>Collectors.partitioningBy 会根据值是否为 true，把集合分割为两个列表，一个 true 列表，一个 false 列表。</p>
<p>例如:</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCollectTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Student&gt; stream = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">21</span>, <span class="number">97D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">21</span>, <span class="number">88D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">24</span>, <span class="number">62D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">18</span>, <span class="number">59D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">24</span>, <span class="number">100D</span>)</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        Map&lt;Boolean, List&lt;Student&gt;&gt; map = stream.collect(Collectors.partitioningBy(s -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> s.getScore() &gt; <span class="number">80</span>;</span><br><span class="line">        &#125;));</span><br><span class="line">        map.forEach((k,v) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;k:&quot;</span> + k + <span class="string">&quot;  v:&quot;</span> + v);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>对流中的数据进行拼接——Collertors.joining<br>Collertors.joining 会根据指定的连接符，将所有的元素连接成一个字符串。</p>
<p>例如：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCollectTest01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;Student&gt; stream = Stream.of(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">21</span>, <span class="number">97D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">21</span>, <span class="number">88D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">24</span>, <span class="number">62D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">18</span>, <span class="number">59D</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">24</span>, <span class="number">100D</span>)</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">        <span class="type">String</span> <span class="variable">collect</span> <span class="operator">=</span> stream.map(Student::getName).collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        System.out.println(collect);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><h2 id="一、获取-Jedis"><a href="#一、获取-Jedis" class="headerlink" title="一、获取 Jedis"></a>一、获取 Jedis</h2><p>Jedis 是基于 java 语言的 redis_cli</p>
<p>maven 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="二、Jedis-基本使用"><a href="#二、Jedis-基本使用" class="headerlink" title="二、Jedis 基本使用"></a>二、Jedis 基本使用</h2><ol>
<li>Jedis 直连</li>
</ol>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202404021525615.webp" alt="img"></p>
<p>Jedis 直连相当于一个 TCP 连接，数据传输完成后关闭连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JedisPool</span> <span class="variable">jedisPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPool</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>); <span class="comment">//创建一个连接池</span></span><br><span class="line"><span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPool.getResource(); <span class="comment">//从连接池获取</span></span><br><span class="line">jedis.set(<span class="string">&quot;token&quot;</span>, UUID.randomUUID().toString());<span class="comment">//此处生成一个随机字符串并存入 Redis</span></span><br><span class="line"><span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;token&quot;</span>);<span class="comment">//从 Redis 获取 key 为 token 的字符串</span></span><br><span class="line">System.out.println(<span class="string">&quot;token = &quot;</span> + token);<span class="comment">//此处打印可以看到我们存入的字符串</span></span><br><span class="line">jedis.close(); <span class="comment">//归还连接</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>简单使用</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CallJedis</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(Jedis jedis)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRedisPool</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyRedisPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>,<span class="literal">null</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(CallJedis callJedis)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPool.getResource())&#123;</span><br><span class="line">            callJedis.call(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisPractice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//实例化连接池</span></span><br><span class="line">        <span class="type">MyRedisPool</span> <span class="variable">myRedisPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRedisPool</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取 Redis 连接资源，并确保在使用后归还</span></span><br><span class="line">        myRedisPool.execute(<span class="keyword">new</span> <span class="title class_">CallJedis</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">call</span><span class="params">(Jedis jedis)</span> &#123;</span><br><span class="line">                <span class="comment">//String</span></span><br><span class="line">                jedis.set(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;huanji&quot;</span>);</span><br><span class="line">                <span class="comment">//Map</span></span><br><span class="line">                jedis.hset(<span class="string">&quot;myhash&quot;</span>,<span class="string">&quot;f1&quot;</span>,<span class="string">&quot;v1&quot;</span>);</span><br><span class="line">                <span class="comment">//List</span></span><br><span class="line">                jedis.rpushx(<span class="string">&quot;mylist&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">                <span class="comment">//Set</span></span><br><span class="line">                jedis.sadd(<span class="string">&quot;myset&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                <span class="comment">//zset</span></span><br><span class="line">                jedis.zadd(<span class="string">&quot;myzset&quot;</span>,<span class="number">22</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                <span class="comment">//获取</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                Map&lt;String, String&gt; map = jedis.hgetAll(<span class="string">&quot;myhash&quot;</span>);</span><br><span class="line">                List&lt;String&gt; mylist = jedis.lrange(<span class="string">&quot;mylist&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">                Set&lt;String&gt; myset = jedis.smembers(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">                List&lt;Tuple&gt; myzset = jedis.zrangeWithScores(<span class="string">&quot;myzset&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">                </span><br><span class="line">                System.out.println(username);</span><br><span class="line">                System.out.println(map.toString());</span><br><span class="line">                System.out.println(mylist.toString());</span><br><span class="line">                System.out.println(myset.toString());</span><br><span class="line">                System.out.println(myzset.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SpringBoot-集成-Redis"><a href="#SpringBoot-集成-Redis" class="headerlink" title="SpringBoot 集成 Redis"></a>SpringBoot 集成 Redis</h1><p>首先导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.83<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 yaml 文件配置 redis 访问地址</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment"># 没有密码不用加 password</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123</span> </span><br></pre></td></tr></table></figure>

<p>配置 FastJson 序列化 Redis</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastJsonRedisSerializer</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">RedisSerializer</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; clazz;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FastJsonRedisSerializer</span><span class="params">(Class&lt;T&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] serialize(T t) <span class="keyword">throws</span> SerializationException &#123;</span><br><span class="line">        <span class="keyword">if</span>(t == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">deserialize</span><span class="params">(<span class="type">byte</span>[] bytes)</span> <span class="keyword">throws</span> SerializationException &#123;</span><br><span class="line">        <span class="keyword">if</span>(bytes == <span class="literal">null</span> || bytes.length &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes,DEFAULT_CHARSET);</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(str,clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> JavaType <span class="title function_">getJavaType</span><span class="params">(Class&lt;?&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> TypeFactory.defaultInstance().constructType(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置 Redis</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(value = &#123;&quot;unchecked&quot;,&quot;rawtypes&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object,Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="type">FastJsonRedisSerializer</span> <span class="variable">serializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastJsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="comment">//使用 StringRedisSerializer 来序列化和反序列化 redis 的 key 值</span></span><br><span class="line">        template.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        template.setValueSerializer(serializer);</span><br><span class="line">        <span class="comment">//Hash 的 key 也采用 StringRedisSerializer 的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        template.setHashValueSerializer(serializer);</span><br><span class="line"></span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 Redis 工具类 RedisCache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(value = &#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisCache</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存基本的对象，Integer、String、实体类等</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 缓存的键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 缓存的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheObject</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> T value)</span></span><br><span class="line">    &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存基本的对象，Integer、String、实体类等</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 缓存的键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 缓存的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout 时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeUnit 时间颗粒度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheObject</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> T value, <span class="keyword">final</span> Integer timeout, <span class="keyword">final</span> TimeUnit timeUnit)</span></span><br><span class="line">    &#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key, value, timeout, timeUnit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置有效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout 超时时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true=设置成功；false=设置失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">expire</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> <span class="type">long</span> timeout)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> expire(key, timeout, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置有效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout 超时时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit 时间单位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true=设置成功；false=设置失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">expire</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> <span class="type">long</span> timeout, <span class="keyword">final</span> TimeUnit unit)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.expire(key, timeout, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取有效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 有效时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getExpire</span><span class="params">(<span class="keyword">final</span> String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断 key 是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false 不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hasKey</span><span class="params">(String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得缓存的基本对象。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 缓存键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 缓存键值对应的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getCacheObject</span><span class="params">(<span class="keyword">final</span> String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue();</span><br><span class="line">        <span class="keyword">return</span> operation.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除单个对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteObject</span><span class="params">(<span class="keyword">final</span> String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除集合对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> collection 多个对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteObject</span><span class="params">(<span class="keyword">final</span> Collection collection)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.delete(collection) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存 List 数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 缓存的键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataList 待缓存的 List 数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 缓存的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="type">long</span> <span class="title function_">setCacheList</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> List&lt;T&gt; dataList)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForList().rightPushAll(key, dataList);</span><br><span class="line">        <span class="keyword">return</span> count == <span class="literal">null</span> ? <span class="number">0</span> : count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得缓存的 list 对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 缓存的键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 缓存键值对应的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">getCacheList</span><span class="params">(<span class="keyword">final</span> String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForList().range(key, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存 Set</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 缓存键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSet 缓存的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 缓存数据的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; BoundSetOperations&lt;String, T&gt; <span class="title function_">setCacheSet</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Set&lt;T&gt; dataSet)</span></span><br><span class="line">    &#123;</span><br><span class="line">        BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key);</span><br><span class="line">        Iterator&lt;T&gt; it = dataSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())</span><br><span class="line">        &#123;</span><br><span class="line">            setOperation.add(it.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> setOperation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得缓存的 set</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Set&lt;T&gt; <span class="title function_">getCacheSet</span><span class="params">(<span class="keyword">final</span> String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存 Map</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataMap</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheMap</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Map&lt;String, T&gt; dataMap)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (dataMap != <span class="literal">null</span>) &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, dataMap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得缓存的 Map</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Map&lt;String, T&gt; <span class="title function_">getCacheMap</span><span class="params">(<span class="keyword">final</span> String key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 往 Hash 中存入数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKey Hash 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">setCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hKey, <span class="keyword">final</span> T value)</span></span><br><span class="line">    &#123;</span><br><span class="line">        redisTemplate.opsForHash().put(key, hKey, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 Hash 中的数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKey Hash 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Hash 中的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hKey)</span></span><br><span class="line">    &#123;</span><br><span class="line">        HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash();</span><br><span class="line">        <span class="keyword">return</span> opsForHash.get(key, hKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取多个 Hash 中的数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKeys Hash 键集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Hash 对象集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">getMultiCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> Collection&lt;Object&gt; hKeys)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().multiGet(key, hKeys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除 Hash 中的某条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key Redis 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hKey Hash 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteCacheMapValue</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hKey)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().delete(key, hKey) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得缓存的基本对象列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern 字符串前缀</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对象列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;String&gt; <span class="title function_">keys</span><span class="params">(<span class="keyword">final</span> String pattern)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.keys(pattern);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 Redis</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/redis&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">redisGet</span><span class="params">()</span>&#123;</span><br><span class="line">        redisCache.setCacheObject(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;huanji&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> redisCache.getCacheObject(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="一、IOC"><a href="#一、IOC" class="headerlink" title="一、IOC"></a>一、IOC</h2><h3 id="什么是-IOC"><a href="#什么是-IOC" class="headerlink" title="什么是 IOC"></a>什么是 IOC</h3><pre><code> Inverse of Control ——**控制反转**，是一种思想，这种**控制反转的思想主要指的是将对象的创建、组装、管理都从代码中自己实现转移到了外部容器中来帮我们进行实现**。在传统的开发方式当中，我们直接手写代码去主动创建和组装对象（将对象所需要的属性注入）；在 IOC 思想中，这个过程被反转了，即由外部容器负责创建和管理对象。

在 IOC 中，我们将应用程序设计成一个个的组件，每个组件提供一定的功能，并通过接口与其他组件进行交互。通过 IOC 容器，我们可以把这些组件注册并配置，**容器负责根据配置信息创建组件实例，并维护它们之间的依赖关系和生命周期。**
</code></pre>
<h3 id="IOC-的实现方式"><a href="#IOC-的实现方式" class="headerlink" title="IOC 的实现方式"></a>IOC 的实现方式</h3><pre><code>IoC 的主要实现方式有两种：依赖查找、依赖注入。

依赖注入是一种更可取的方式。

那么依赖查找和依赖注入有什么区别呢？

依赖查找，主要是容器为组件提供一个回调接口和上下文环境。这样一来，组件就必须自己使用容器提供的 API 来查找资源和协作对象，控制反转仅体现在那些回调方法上，容器调用这些回调方法，从而应用代码获取到资源。

依赖注入，组件不做定位查询，只提供标准的 Java 方法让容器去决定依赖关系。容器全权负责组件的装配，把符合依赖关系的对象通过 Java Bean 属性或构造方法传递给需要的对象。
</code></pre>
<h4 id="IOC-容器"><a href="#IOC-容器" class="headerlink" title="IOC 容器"></a>IOC 容器</h4><pre><code>IoC 容器：具有依赖注入功能的容器，可以创建对象的容器。IoC 容器负责实例化、定位、配置应用程序中的对象并建立这些对象之间的依赖。
</code></pre>
<h4 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h4><pre><code>DI，英文名称，Dependency Injection，意为依赖注入。

依赖注入：由 IoC 容器动态地将某个对象所需要的外部资源（包括对象、资源、常量数据）注入到组件 (Controller, Service 等）之中。简单点说，就是 IoC 容器会把当前对象所需要的外部资源动态的注入给我们。

Spring 依赖注入的方式主要有四个，基于注解注入方式、set 注入方式、构造器注入方式、静态工厂注入方式。推荐使用基于注解注入方式，配置较少，比较方便。
</code></pre>
<p>基于注解注入方式：</p>
<p>服务层代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//code   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制层代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//多实例 每次获取 Bean 的时候会有一个新的实例 看情况添加 大部分场景不用加</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminController</span> &#123;</span><br><span class="line">	<span class="comment">//自动装配</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AdminService adminService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Autowired 与@Resource 都可以用来装配 Bean，都可以写在字段、setter 方法上。他们的区别是：</p>
<pre><code>@Autowired 默认按类型进行自动装配（该注解属于 Spring），默认情况下要求依赖对象必须存在，如果要允许为 null，需设置 required 属性为 false，例：@Autowired(required=false)。如果要使用名称进行装配，可以与@Qualifier 注解一起使用。
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;adminService&quot;)</span></span><br><span class="line"><span class="keyword">private</span> AdminService adminService;</span><br></pre></td></tr></table></figure>

<pre><code>@Resource 默认按照名称进行装配（该注解属于 J2EE），名称可以通过 name 属性来指定。如果没有指定 name 属性，当注解写在字段上时，默认取字段名进行装配；如果注解写在 setter 方法上，默认取属性名进行装配。当找不到与名称相匹配的 Bean 时，会按照类型进行装配。但是，name 属性一旦指定，就只会按照名称进行装配。
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource(name = &quot;adminService&quot;)</span></span><br><span class="line"><span class="keyword">private</span> AdminService adminService;</span><br></pre></td></tr></table></figure>

<pre><code>除此之外，对于一些复杂的装载 Bean 的时机，比如我们需要根据配置装载不同的 Bean，以完成不同的操作，可以使用 getBean(“beanID”) 的方式来加载 Bean。

通过 BeanID 加载 Bean 方法如下：
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanUtils</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (BeanUtils.applicationContext == <span class="literal">null</span>) &#123;</span><br><span class="line">        	BeanUtils.applicationContext = applicationContext;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title function_">getApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    	<span class="keyword">return</span> applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getBean</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="keyword">return</span> applicationContext.containsBean(id) ? applicationContext.getBean(id) : <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BeansException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;not found bean id: &quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在需要加载 Bean 的地方调用该方法即可</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> IService <span class="title function_">loadService</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">IService</span> <span class="variable">iService</span> <span class="operator">=</span> (IService) BeanUtils.getBean(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (iService != <span class="literal">null</span>) &#123;</span><br><span class="line">        	<span class="keyword">return</span> iService;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;加载 Bean 错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="二、AOP"><a href="#二、AOP" class="headerlink" title="二、AOP"></a>二、AOP</h2><h3 id="什么是-AOP"><a href="#什么是-AOP" class="headerlink" title="什么是 AOP"></a>什么是 AOP</h3><pre><code>AOP 即面向切面编程，可以将那些与业务不想关但是很多业务都需要调用的代码提取出来，思想就是不侵入原有代码的同时对功能进行增强。

AOP 通过定义一个切面，切面可以横切到应用程序的多个模块中，并添加增强的行为。这样我们就可以将通用的功能逻辑从业务逻辑中解耦出来，提高代码的可维护性和重用性。

AOP 主要一般应用于签名验签、参数校验、日志记录、事务控制、权限控制、性能统计、异常处理等。
</code></pre>
<h3 id="AOP-涉及名词"><a href="#AOP-涉及名词" class="headerlink" title="AOP 涉及名词"></a>AOP 涉及名词</h3><ul>
<li><p>目标对象（Target）：需要对它进行操作的业务类</p>
</li>
<li><p>连接点（JoinPoint）：程序在运行过程中能够插入切面的地点。</p>
<ul>
<li>例如，方法调用、异常抛出等。Spring 只支持方法级的连接点。</li>
<li>一个类的所有方法前、后、抛出异常时等都是连接点。</li>
</ul>
</li>
<li><p>切入点（Pointcut）：用于定义通知应该切入到哪些连接点上。不同的通知通常需要切入到不同的连接点上，这种精准的匹配是由切入点的正则表达式来定义的。</p>
</li>
<li><p>通知（Advice）：切面的具体实现。就是要给目标对象织入的事情。<br>以目标方法为参照点，根据放置的地方不同，可分为：</p>
<ul>
<li><p>前置通知（Before）</p>
</li>
<li><p>后置通知（AfterReturning）</p>
</li>
<li><p>异常通知（AfterThrowing）</p>
</li>
<li><p>最终通知（After）</p>
</li>
<li><p>环绕通知（Around）</p>
<p>5 种。在实际开发中通常是切面类中的一个方法，具体属于哪类通知，通过方法上的注解区分。</p>
</li>
</ul>
</li>
<li><p>切面（Aspect）：共有功能的实现。如日志切面、权限切面、验签切面等。</p>
<ul>
<li>在实际开发中通常是一个存放共有功能实现的标准 Java 类。</li>
<li>当 Java 类使用了@Aspect 注解修饰时，就能被 AOP 容器识别为切面。</li>
<li>是通知和切点的结合，通知和切点共同定义了切面的全部内容</li>
</ul>
</li>
<li><p>织入（Weaving）：将切面应用到目标对象从而创建一个新的代理对象的过程。这个过程可以发生在编译时、类加载时、运行时。Spring 是在运行时完成织入，运行时织入通过 Java 语言的反射机制与动态代理机制来动态实现。</p>
</li>
<li><p>代理对象（Proxy）：将通知应用到目标对象之后被动态创建的对象。可以简单地理解为，代理对象的功能等于目标对象本身业务逻辑加上共有功能。代理对象对于使用者而言是透明的，是程序运行过程中的产物。目标对象被织入共有功能后产生的对象。</p>
</li>
</ul>
<p><strong>切入点（Pointcut）用法：</strong></p>
<pre><code>Pointcut 格式为：

execution(modifier-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) throws-pattern?)

1. 修饰符匹配 modifier-pattern? 例：public private
2. 返回值匹配 ret-type-pattern 可以用 * 表示任意返回值
3. 类路径匹配 declaring-type-pattern? 全路径的类名
4. 方法名匹配 name-pattern 可以指定方法名或者用 * 表示所有方法；set* 表示所有以 set 开头的方法
5. 参数匹配 (param-pattern) 可以指定具体的参数类型，多个参数用“,”分隔；可以用 * 表示匹配任意类型的参数；可以用 (..) 表示零个或多个任意参数
6. 异常类型匹配 throws-pattern? 例：throws Exception
</code></pre>
<p>其中后面跟着？表示可选项</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(public * cn.wbnull.springbootdemo.controller.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AOP-实现"><a href="#AOP-实现" class="headerlink" title="AOP 实现"></a>AOP 实现</h3><pre><code>SpringAOP 是基于动态代理实现的，动态代理有两种，一种是 JDK 动态代理，另一种是 Cglib 动态代理

jdk 动态代理是利用反射的原理来实现的，需要调用反射包下的 Proxy 类的 newProxyInstance 方法来返回代理对象，这个方法中有**三个参数**，分别是用于**加载代理类的类加载器**、**被代理类实现的接口的 class 数组**、**用于增强方法的 InvocatioHandler 实现类**

 cglib 动态代理原理是利用 asm 开源包来实现的，是把被代理类的 class 文件加载进来，通过修改它的字节码生成子类来处理

jdk 动态代理要求代理类必须有实现的接口，生成的动态代理类会和代理类实现同样的接口，cglib 则，生成的动态代理类会继承被代理类。**Spring 默认使用 jdk 动态代理，当要被代理的类没有实现任何接口的时候采用 cglib**。
</code></pre>
<p>例如：</p>
<p>这是一个实现统计 controller 路由访问次数的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodCount</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 声明一个 Map 类型的对象，用于存储方法调用次数</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; count = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 定义切点，表示拦截 com.qcby.springbootdemo.Controller 包下的所有方法</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.qcby.springbootdemo.Controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">count</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;切点方法执行&quot;</span>);   <span class="comment">//声明切点，并不会实际调用</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 环绕通知，在目标方法执行前后进行拦截</span></span><br><span class="line">    <span class="meta">@Around(&quot;count()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">methodExec</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行前&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 获取方法签名信息</span></span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> pjp.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> signature.getName();</span><br><span class="line">        System.out.println(name);   <span class="comment">//-----login</span></span><br><span class="line">        System.out.println(signature.getDeclaringTypeName());  <span class="comment">//---com.qcby.springbootdemo.Controller.LoginController</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 获取方法参数</span></span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">        <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;aop arg:&quot;</span> + arg);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        System.out.println(signature.toLongString());</span><br><span class="line">        System.out.println();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 统计方法调用次数，使用方法的签名作为 key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> signature.toLongString();</span><br><span class="line">        count.put(key, count.getOrDefault(key, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 执行目标方法</span></span><br><span class="line">        result = pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行后&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 输出访问路由次数</span></span><br><span class="line">        System.out.println(count);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、Bean-容器基本理论"><a href="#三、Bean-容器基本理论" class="headerlink" title="三、Bean 容器基本理论"></a>三、Bean 容器基本理论</h2><p>Spring Bean 容器是 Spring 框架的核心组件之一，负责管理和组织应用中的对象（也称为 Bean）	</p>
<ol>
<li><p>什么是 Bean？</p>
<ul>
<li>在 Spring 中，Bean 是指由 Spring 容器管理的对象。这些对象通常是应用中的组件，例如服务、数据访问对象、实体等。</li>
</ul>
</li>
<li><p>Spirng Bean 容器的作用：</p>
<ul>
<li>Spring Bean 容器负责创建、管理和注入（或装配）应用中的 Bean。它提供了一个环境，使得开发者可以通过配置文件或者注解的方式定义和组织 Bean。</li>
</ul>
</li>
<li><p>Bean 的生命周期</p>
<ul>
<li>Bean 的生命周期包括实例化、初始化、使用和销毁四个阶段。</li>
<li>Spring 容器负责在适当的时机执行这些阶段的操作，例如通过构造函数实例化 Bean、调用初始化方法、提供 Bean 给其他组件使用，最后在应用关闭时销毁 Bean。</li>
</ul>
</li>
<li><p>Bean 的作用域：</p>
<ul>
<li>Spring 支持多种 Bean 的作用域，包括单例（Singleton）、原型（Prototype）、会话（Session）、请求（Request）等。</li>
<li>每种作用域定义了 Bean 实例的生命周期和访问范围。</li>
</ul>
</li>
<li><p>Bean 的装配：</p>
<ul>
<li>装配是指将不同的 Bean 组装在一起，形成应用的组件关系。</li>
<li>Spring 支持通过 XML 配置、注解和 JAVA 配置等方式进行 Bean 的装配</li>
</ul>
</li>
<li><p>Bean 的依赖注入</p>
<ul>
<li>依赖注入是 Spring 框架的一个关键特性，它通过将一个 Bean 的依赖关系通过构造函数、Setter 方法或者接口注入到另一个 Bean 中。这样可以降低组件之间的耦合度。</li>
</ul>
</li>
<li><p>Bean 的自动装配：</p>
<ul>
<li>Spring 支持自动装配，通过指定 <code>@Autowired</code> 注解或者使用 XML 配置，Spring 可以自动识别和满足 Bean 之间的依赖关系。</li>
</ul>
</li>
<li><p>ApplicationContext 和 BeanFactory：</p>
<ul>
<li>Spring 提供了两个核心的容器接口，即<code>ApplicationContext</code>和<code>BeanFactory</code>。<code>ApplicationContext</code>是<code>BeanFactory</code>的子接口，提供了更丰富的功能，例如事件传播、AOP 等。</li>
</ul>
</li>
<li><p>配置元数据：</p>
<ul>
<li>Bean 的配置信息通常使用配置元数据来定义，可以使用 XML 文件、Java 配置类或者注解。配置元数据包含了 Bean 的类型、依赖关系、作用域、初始化方法、销毁方法等信息。</li>
</ul>
</li>
</ol>
<p>总体而言，Spring Bean 容器为开发者提供了一种松散耦合的方式来组织和管理应用中的组件，使得应用更加灵活、可维护和可测试。</p>
<h2 id="四、Spring-注解"><a href="#四、Spring-注解" class="headerlink" title="四、Spring 注解"></a>四、Spring 注解</h2><ol>
<li><p>声明 bean 的注解</p>
<ul>
<li><p>@Component：泛指各种组件</p>
</li>
<li><p>@Controller、@Service、@Repository 都可以称为@Component</p>
</li>
<li><p>@Controller：控制层</p>
</li>
<li><p>@Service：业务层</p>
</li>
<li><p>@Repository：数据访问层</p>
</li>
</ul>
</li>
<li><p>注入 bean 的注解</p>
<ul>
<li>@Autowired：由 Spring 提供</li>
<li>@Inject：由 JSR-330 提供</li>
<li>@Resource：由 JSR-250 提供</li>
</ul>
</li>
<li><p>Java 配置类相关注解</p>
<ul>
<li>@Configuration：声明当前类为配置类</li>
<li>@Bean：注解在方法上，声明当前方法的返回值为一个 bean，替代 xml 中的方式</li>
<li>@ComponentScan：用于对 Component 进行扫描</li>
</ul>
</li>
<li><p>切面（AOP）相关注解</p>
<ul>
<li>@Aspect：声明一个切面</li>
<li>@After：在方法执行之后执行（方法上）</li>
<li>@Before：在方法执行之前执行（方法上）</li>
<li>@Around：在方法执行之前与之后执行（方法上）</li>
<li>@PointCut：声明切点</li>
<li>@EnableAspectJAutoProxy：开启 Spring 对 AspectJ 代理的支持</li>
</ul>
</li>
<li><p>@Bean 的属性支持</p>
<ul>
<li>@Scope 设置类型包括：设置 Spring 容器如何新建 Bean 实例</li>
<li>Singleton：单例,一个 Spring 容器中只有一个 bean 实例，默认模式</li>
<li>Protetype：每次调用新建一个 bean</li>
<li>Request：web 项目中，给每个 http request 新建一个 bean</li>
<li>Session：web 项目中，给每个 http session 新建一个 bean</li>
<li>GlobalSession：给每一个 global http session 新建一个 Bean 实例</li>
</ul>
</li>
<li><p>@Value 注解</p>
<ul>
<li>注入普通字符、注入操作系统属性、注入表达式结果、注入其它 bean 属性、注入文件资源、注入网站资源、注入配置文件</li>
</ul>
</li>
<li><p>环境切换</p>
<ul>
<li>@Profile：指定组件在哪个环境的情况下才能被注册到容器中，不指定，任何环境下都能注册这个组件。</li>
<li>@Conditional：通过实现 Condition 接口，并重写 matches 方法，从而决定该 bean 是否被实例化。</li>
</ul>
</li>
<li><p>异步相关</p>
<ul>
<li>@EnableAsync：配置类中通过此注解开启对异步任务的支持</li>
<li>@Async：在实际执行的 bean 方法使用该注解来声明其是一个异步任务（方法上或类上所有的方法都将异步，需要@EnableAsync 开启异步任务）</li>
</ul>
</li>
<li><p>定时任务相关</p>
<ul>
<li>@EnableScheduling：在配置类上使用，开启计划任务的支持</li>
<li>@Scheduled：来申明这是一个任务，包括 cron,fixDelay,fixRate 等类型（方法上，需先开启计划任务的支持）</li>
</ul>
</li>
<li><p>Enable***注解说明</p>
<ul>
<li>@EnableAspectAutoProxy：开启对 AspectJ 自动代理的支持</li>
<li>@EnableAsync：开启异步方法的支持</li>
<li>@EnableScheduling：开启计划任务的支持</li>
<li>@EnableWebMvc：开启 web MVC 的配置支持</li>
<li>@EnableConfigurationProperties：开启对@ConfigurationProperties 注解配置 Bean 的支持</li>
<li>@EnableJpaRepositories：开启对 SpringData JPA Repository 的支持</li>
<li>@EnableTransactionManagement：开启注解式事务的支持</li>
<li>@EnableCaching：开启注解式的缓存支持</li>
</ul>
</li>
<li><p>测试相关注解</p>
<ul>
<li>@RunWith：运行器，Spring 中通常用于对 JUnit 的支持</li>
<li>@ContextConfiguration<br>用来加载配置文件，其中 classess 属性用来加载配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &#123;&quot;classpath*:/*.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CDPlayerTest</span> &#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="五、SpringBoot-注解"><a href="#五、SpringBoot-注解" class="headerlink" title="五、SpringBoot 注解"></a>五、SpringBoot 注解</h2><ol>
<li><p>@SpringBootApplication:<br><code>SpringBoot</code>的核心注解，主要目的是开启自动配置。它也是一个组合注解，主要组合了<code>@Configuration，@EnableAutoConfiguration（核心）和@ComponentScan</code>。可以通过<code>@SpringBootApplication</code>(exclude&#x3D;{想要关闭的自动配置的类名.class}) 来关闭特定的自动配置，其中<code>@ComponentScan</code>让<code>spring Boot</code>扫描到<code>Configuration</code>类并把它加入到程序上下文。</p>
</li>
<li><p>@EnableAutoConfiguration<br>此注释自动载入应用程序所需的所有<code>Bean</code>——这依赖于<code>Spring Boot</code>在类路径中的查找。该注解组合了<code>@Import</code>注解，<code>@Import</code>注解导入了<code>EnableAutoCofigurationImportSelector</code>类，它使用<code>SpringFactoriesLoader.loaderFactoryNames</code>方法来扫描具有<code>META-INF/spring.factories</code>文件的<code>jar</code>包。而<code>spring.factories</code>里声明了有哪些自动配置.</p>
</li>
<li><p>@Configuration:<br>等同于<code>spring</code>的<code>XML</code>配置文件；使用<code>Java</code>代码可以检查类型安全。</p>
</li>
<li><p>@ComponentScan</p>
<p>表示将该类自动发现扫描组件。个人理解相当于，如果扫描到有<code>@Component、@Controller、@Service</code>等这些注解的类，并注册为<code>Bean</code>，可以自动收集所有的<code>Spring</code>组件，包括<code>@Configuration</code>类。</p>
</li>
</ol>
<h1 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h1><h2 id="SpringBoot-项目部署-SpringSecurity"><a href="#SpringBoot-项目部署-SpringSecurity" class="headerlink" title="SpringBoot 项目部署 SpringSecurity"></a>SpringBoot 项目部署 SpringSecurity</h2><h3 id="数据库表结构"><a href="#数据库表结构" class="headerlink" title="数据库表结构"></a>数据库表结构</h3><ol>
<li>user 表 用户</li>
</ol>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed@main/img/202403021920546.png" alt="image-20240302192031335"></p>
<ol start="2">
<li>role 表 角色</li>
</ol>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed@main/img/202403021920509.png" alt="image-20240302192056423"></p>
<ol start="3">
<li>user_role 表 用户角色关系</li>
</ol>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed@main/img/202403021923922.png" alt="image-20240302192331838"></p>
<ol start="4">
<li>permission 表 系统权限</li>
</ol>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202403021924592.png" alt="image-20240302192457504"></p>
<ol start="5">
<li>role_permission 表 角色权限关联</li>
</ol>
<p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202403021925052.png" alt="image-20240302192548970"></p>
<h3 id="pom-文件"><a href="#pom-文件" class="headerlink" title="pom 文件"></a>pom 文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.huanji<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_security_practice<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring_security_practice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>spring_security_practice<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-spring-boot3-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--security--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.40<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jjwt 依赖包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- hutool 工具类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="yaml-配置"><a href="#yaml-配置" class="headerlink" title="yaml 配置"></a>yaml 配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springboot3-security-jwt</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#数据库驱动完整类名</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment">#数据库连接 url</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/security_practice?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="comment">#数据库用户名</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="comment">#数据库密码</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="comment"># Logger Config</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.hexadecimal:</span> <span class="string">debug</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/sq</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime lastLoginTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_permission&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Permission</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> Integer method;</span><br><span class="line">    <span class="keyword">private</span> String service;</span><br><span class="line">    <span class="keyword">private</span> Integer parentId;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_user_role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRole</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_role_permission&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RolePermission</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> Integer roleId;</span><br><span class="line">    <span class="keyword">private</span> Integer permissionId;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mapper-类"><a href="#Mapper-类" class="headerlink" title="Mapper 类"></a>Mapper 类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Role&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PermissionMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Permission&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRoleMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;UserRole&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RolePermissionMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;RolePermission&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Service-类"><a href="#Service-类" class="headerlink" title="Service 类"></a>Service 类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper mapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleService userRoleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RolePermissionService rolePermissionService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionService permissionService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取权限</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Permission&gt; <span class="title function_">getPermissionByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">super</span>.getOne(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getUsername, username), <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getPermissionByUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Permission&gt; <span class="title function_">getPermissionByUserId</span><span class="params">(Integer userId)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="built_in">super</span>.getById(userId);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getPermissionByUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Permission&gt; <span class="title function_">getPermissionByUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        List&lt;Permission&gt; permissions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> != user) &#123;</span><br><span class="line">            <span class="comment">//获取用户对应的全部角色</span></span><br><span class="line">            List&lt;UserRole&gt; userRoles = userRoleService.list(Wrappers.&lt;UserRole&gt;lambdaQuery().eq(UserRole::getUserId, user.getId()));</span><br><span class="line">            <span class="comment">//如果不为空</span></span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isNotEmpty(userRoles)) &#123;</span><br><span class="line">                List&lt;Integer&gt; roleIds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                userRoles.stream().forEach(userRole -&gt; &#123;</span><br><span class="line">                    roleIds.add(userRole.getRoleId());</span><br><span class="line">                &#125;);</span><br><span class="line">                List&lt;RolePermission&gt; rolePermissions = rolePermissionService.list(Wrappers.&lt;RolePermission&gt;lambdaQuery().in(RolePermission::getRoleId, roleIds));</span><br><span class="line">                <span class="comment">//如果不为空</span></span><br><span class="line">                <span class="keyword">if</span> (CollectionUtils.isNotEmpty(rolePermissions)) &#123;</span><br><span class="line">                    <span class="comment">//获取角色拥有权限的 id</span></span><br><span class="line">                    List&lt;Integer&gt; permissionIds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                    rolePermissions.stream().forEach(rolePermission -&gt; &#123;</span><br><span class="line">                        permissionIds.add(rolePermission.getPermissionId());</span><br><span class="line">                    &#125;);</span><br><span class="line">                    permissions = permissionService.list(Wrappers.&lt;Permission&gt;lambdaQuery().in(Permission::getId, permissionIds));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> permissions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RoleMapper, Role&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PermissionService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;PermissionMapper, Permission&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RolePermissionService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RolePermissionMapper, RolePermission&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserRoleService</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserRoleMapper, UserRole&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="用户登录请求实体"><a href="#用户登录请求实体" class="headerlink" title="用户登录请求实体"></a>用户登录请求实体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口响应实体"><a href="#接口响应实体" class="headerlink" title="接口响应实体"></a>接口响应实体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultData</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应状态码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResultData&lt;String&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="title function_">success</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="string">&quot;ok&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="title function_">success</span><span class="params">(String message, T data)</span> &#123;</span><br><span class="line">        ResultData&lt;T&gt; resultDTO = <span class="keyword">new</span> <span class="title class_">ResultData</span>&lt;T&gt;();</span><br><span class="line">        resultDTO.setCode(ResponseCodeEnum.OK.getCode());</span><br><span class="line">        resultDTO.setMessage(message);</span><br><span class="line">        resultDTO.setData(data);</span><br><span class="line">        <span class="keyword">return</span> resultDTO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="title function_">error</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> error(ResponseCodeEnum.ERROR, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="title function_">error</span><span class="params">(ResponseCodeEnum responseCode, Throwable e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> error(responseCode, e.getMessage() != <span class="literal">null</span> ? e.getMessage() : <span class="string">&quot;系统异常，请联系管理员！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ResultData&lt;T&gt; <span class="title function_">error</span><span class="params">(ResponseCodeEnum responseCode, String message)</span> &#123;</span><br><span class="line">        ResultData&lt;T&gt; resultDTO = <span class="keyword">new</span> <span class="title class_">ResultData</span>&lt;T&gt;();</span><br><span class="line">        resultDTO.setCode(responseCode.getCode());</span><br><span class="line">        resultDTO.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> resultDTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="响应码枚举"><a href="#响应码枚举" class="headerlink" title="响应码枚举"></a>响应码枚举</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应状态码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ResponseCodeEnum</span> &#123;</span><br><span class="line">    OK(<span class="number">200</span>, <span class="string">&quot;请求成功&quot;</span>),</span><br><span class="line"></span><br><span class="line">    BAD_REQUEST(<span class="number">400</span>, <span class="string">&quot;失败的请求&quot;</span>),</span><br><span class="line"></span><br><span class="line">    UNAUTHORIZED(<span class="number">401</span>, <span class="string">&quot;未授权&quot;</span>),</span><br><span class="line"></span><br><span class="line">    FORBIDDEN(<span class="number">403</span>, <span class="string">&quot;禁止访问&quot;</span>),</span><br><span class="line"></span><br><span class="line">    NOT_FOUND(<span class="number">404</span>, <span class="string">&quot;请求找不到&quot;</span>),</span><br><span class="line"></span><br><span class="line">    NOT_ACCEPTABLE(<span class="number">406</span>, <span class="string">&quot;不可访问&quot;</span>),</span><br><span class="line"></span><br><span class="line">    CONFLICT(<span class="number">409</span>, <span class="string">&quot;冲突&quot;</span>),</span><br><span class="line"></span><br><span class="line">    ERROR(<span class="number">500</span>, <span class="string">&quot;服务器发生异常&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    ResponseCodeEnum(Integer code, String message) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getMessage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ResponseCodeEnum responseCode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BaseException</span><span class="params">(ResponseCodeEnum responseCode, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line"></span><br><span class="line">        setResponseCode(responseCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 BaseException</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BaseException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData&lt;String&gt; <span class="title function_">handlerGlobalException</span><span class="params">(HttpServletResponse response, BaseException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;请求异常：&quot;</span>, e);</span><br><span class="line">        response.setStatus(e.getResponseCode().getCode());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultData.error(e.getResponseCode(), e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 BindException</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BindException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.BAD_REQUEST)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData&lt;String&gt; <span class="title function_">handlerBindException</span><span class="params">(BindException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;请求异常：&quot;</span>, e);</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        <span class="type">FieldError</span> <span class="variable">fieldError</span> <span class="operator">=</span> bindingResult.getFieldError();</span><br><span class="line">        <span class="keyword">assert</span> fieldError != <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">defaultMessage</span> <span class="operator">=</span> fieldError.getDefaultMessage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultData.error(ResponseCodeEnum.BAD_REQUEST, defaultMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 Exception</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData&lt;String&gt; <span class="title function_">handlerException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;请求异常：&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultData.error(ResponseCodeEnum.ERROR, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MyBtaisPlus-配置"><a href="#MyBtaisPlus-配置" class="headerlink" title="MyBtaisPlus 配置"></a>MyBtaisPlus 配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.huanji.spring_security_practice.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInnerInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JWT-工具类"><a href="#JWT-工具类" class="headerlink" title="JWT 工具类"></a>JWT 工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET</span> <span class="operator">=</span> <span class="string">&quot;zxcvbnmfdasaererafafafafafafakjlkjalkfafadffdafadfafafaaafadfadfaf1234567890&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HEADER</span> <span class="operator">=</span> <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成 jwt token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateToken</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">signingKey</span> <span class="operator">=</span> Keys.hmacShaKeyFor(SECRET.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        <span class="comment">//过期时间</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">tokenExpirationTime</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(EXPIRE);</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                <span class="comment">//使用 HMAC SHA-512 签名算法和指定的密钥对 Token 进行签名。</span></span><br><span class="line">                .signWith(signingKey, Jwts.SIG.HS512)</span><br><span class="line">                <span class="comment">// 设置 Token 的头部信息</span></span><br><span class="line">                .header().add(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>).and()</span><br><span class="line">                <span class="comment">// 设置 Token 的签发时间</span></span><br><span class="line">                .issuedAt(Timestamp.valueOf(LocalDateTime.now()))</span><br><span class="line">                <span class="comment">// 设置 Token 的主题，通常为用户名</span></span><br><span class="line">                .subject(username)</span><br><span class="line">                <span class="comment">// 设置 Token 的过期时间</span></span><br><span class="line">                .expiration(Timestamp.valueOf(tokenExpirationTime))</span><br><span class="line">                <span class="comment">// 向 Token 中添加自定义的声明信息</span></span><br><span class="line">                .claims(Map.of(<span class="string">&quot;username&quot;</span>, username))</span><br><span class="line">                <span class="comment">// 生成最终的 Token 字符串</span></span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过令牌获取声明信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token JWT 令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 包含声明信息的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Claims <span class="title function_">getClaimsByToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用密钥创建签名密钥</span></span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">signingKey</span> <span class="operator">=</span> Keys.hmacShaKeyFor(SECRET.getBytes(StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析令牌并验证签名</span></span><br><span class="line">        <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">                <span class="comment">//使用指定的密钥进行验证，确保 Token 的签名有效。</span></span><br><span class="line">                .verifyWith(signingKey)</span><br><span class="line">                <span class="comment">//构建 JWT Parser，准备解析 Token。</span></span><br><span class="line">                .build()</span><br><span class="line">                <span class="comment">//解析已签名的 Token，验证签名并获取 Token 的声明（Claims）。</span></span><br><span class="line">                .parseSignedClaims(token)</span><br><span class="line">                <span class="comment">//获取 Token 的负载（Payload），即包含在 Token 中的用户定义的信息。</span></span><br><span class="line">                .getPayload();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查 token 是否过期</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true：过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTokenExpired</span><span class="params">(Date expiration)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expiration.before(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得 token 中的自定义信息,一般是获取 token 的 username，无需 secret 解密也能获得</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filed</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getClaimFiled</span><span class="params">(String token, String filed)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">DecodedJWT</span> <span class="variable">jwt</span> <span class="operator">=</span> JWT.decode(token);</span><br><span class="line">            <span class="keyword">return</span> jwt.getClaim(filed).asString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JWTDecodeException e)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;JwtUtil getClaimFiled error: &quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="账户信息实体"><a href="#账户信息实体" class="headerlink" title="账户信息实体"></a>账户信息实体</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> accountNonExpired;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> accountNonLocked;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> credentialsNonExpired;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> enabled;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountUser</span><span class="params">(Integer userId, String username, String password, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(userId, username, password, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, authorities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountUser</span><span class="params">(Integer userId, String username, String password, <span class="type">boolean</span> enabled, <span class="type">boolean</span> accountNonExpired, <span class="type">boolean</span> credentialsNonExpired, <span class="type">boolean</span> accountNonLocked, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> &#123;</span><br><span class="line">        Assert.isTrue(username != <span class="literal">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(username) &amp;&amp; password != <span class="literal">null</span>, <span class="string">&quot;Cannot pass null or empty values to constructor&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.enabled = enabled;</span><br><span class="line">        <span class="built_in">this</span>.accountNonExpired = accountNonExpired;</span><br><span class="line">        <span class="built_in">this</span>.credentialsNonExpired = credentialsNonExpired;</span><br><span class="line">        <span class="built_in">this</span>.accountNonLocked = accountNonLocked;</span><br><span class="line">        <span class="built_in">this</span>.authorities = authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.accountNonExpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.accountNonLocked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.credentialsNonExpired;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.enabled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JWTAuthenticationFilter-过滤器"><a href="#JWTAuthenticationFilter-过滤器" class="headerlink" title="JWTAuthenticationFilter 过滤器"></a>JWTAuthenticationFilter 过滤器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JwtUtil jwtUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountUserDetailsService accountUserDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进行 JWT Token 验证的过滤器。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  HTTP 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HTTP 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain    过滤器链</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果发生 I/O 错误</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果发生 Servlet 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 从请求头中获取 JWT Token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(JwtUtil.HEADER);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果未获取到 Token，继续往后执行，因为后面可能有鉴权管理器等组件判断是否拥有身份凭证，可以放行</span></span><br><span class="line">        <span class="comment">// 没有 Token 相当于匿名访问，若有一些接口是需要权限的，则不能访问这些接口</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlankOrUndefined(token)) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析并验证 JWT Token，获取 Token 的声明信息（Claims）</span></span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> jwtUtil.getClaimsByToken(token);</span><br><span class="line">        <span class="keyword">if</span> (claims == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BaseException</span>(ResponseCodeEnum.BAD_REQUEST, <span class="string">&quot;Token 异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查 Token 是否过期</span></span><br><span class="line">        <span class="keyword">if</span> (jwtUtil.isTokenExpired(claims.getExpiration())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BaseException</span>(ResponseCodeEnum.BAD_REQUEST, <span class="string">&quot;Token 已过期&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从 Token 的声明信息中获取用户名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> claims.getSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建 UsernamePasswordAuthenticationToken</span></span><br><span class="line">        <span class="comment">// 这里密码为 null，是因为提供了正确的 Token，实现自动登录</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(username, <span class="literal">null</span>, accountUserDetailsService.getUserAuthority(username));</span><br><span class="line">        authentication.setDetails(<span class="keyword">new</span> <span class="title class_">WebAuthenticationDetailsSource</span>().buildDetails(request));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将认证信息设置到 Security 上下文中</span></span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 继续执行后续的过滤器链</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="认证-授权"><a href="#认证-授权" class="headerlink" title="认证&#x2F;授权"></a>认证&#x2F;授权</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理访问被拒绝（Access Denied）情况的方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest  HTTP 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletResponse HTTP 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e                   访问被拒绝的异常对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果发生 I/O 错误</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果发生 Servlet 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 设置响应的内容类型为 JSON 格式，并指定字符集为 UTF-8</span></span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置响应状态码为 403 Forbidden</span></span><br><span class="line">        httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建包含错误信息的 ResultData 对象</span></span><br><span class="line">        ResultData&lt;String&gt; resultDTO = ResultData.error(e.getMessage());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取输出流，将 ResultData 对象转为 JSON 字符串并写入响应</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> httpServletResponse.getOutputStream();</span><br><span class="line">        outputStream.write(JSONUtil.toJsonStr(resultDTO).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        outputStream.flush();</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationEntryPoint</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理身份验证失败（未经授权）情况的方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest  HTTP 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletResponse HTTP 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e                   身份验证异常对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果发生 I/O 错误</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果发生 Servlet 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 设置响应的内容类型为 JSON 格式，并指定字符集为 UTF-8</span></span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置响应状态码为 401 Unauthorized</span></span><br><span class="line">        httpServletResponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建包含错误信息的 ResultData 对象</span></span><br><span class="line">        ResultData&lt;String&gt; resultDTO = ResultData.error(<span class="string">&quot;请先登录&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取输出流，将 ResultData 对象转为 JSON 字符串并写入响应</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> httpServletResponse.getOutputStream();</span><br><span class="line">        outputStream.write(JSONUtil.toJsonStr(resultDTO).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        outputStream.flush();</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationSuccessHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JwtUtil jwtUtil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理身份验证成功事件的方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest  HTTP 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletResponse HTTP 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authentication      包含了有关已进行身份验证的主体的信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果发生 I/O 错误</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果发生 Servlet 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationSuccess</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 设置响应的内容类型为 JSON 格式，并指定字符集为 UTF-8</span></span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成 JWT Token，并将其放置到响应头中</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> jwtUtil.generateToken(authentication.getName());</span><br><span class="line">        httpServletResponse.setHeader(JwtUtil.HEADER, token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建登录成功的 ResultData 对象</span></span><br><span class="line">        ResultData&lt;String&gt; resultDTO = ResultData.success(<span class="string">&quot;SuccessLogin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取输出流，将 ResultData 对象转为 JSON 字符串并写入响应</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> httpServletResponse.getOutputStream();</span><br><span class="line">        outputStream.write(JSONUtil.toJsonStr(resultDTO).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        outputStream.flush();</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginFailureHandler</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationFailureHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理身份验证失败事件的方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest  HTTP 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletResponse HTTP 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e                   身份验证失败的异常对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果发生 I/O 错误</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果发生 Servlet 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAuthenticationFailure</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AuthenticationException e)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 设置响应的内容类型为 JSON 格式，并指定字符集为 UTF-8</span></span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建包含身份验证失败信息的 ResultData 对象</span></span><br><span class="line">        ResultData&lt;String&gt; resultDTO = ResultData.error(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取输出流，将 ResultData 对象转为 JSON 字符串并写入响应</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> httpServletResponse.getOutputStream();</span><br><span class="line">        outputStream.write(JSONUtil.toJsonStr(resultDTO).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        outputStream.flush();</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtLogoutSuccessHandler</span> <span class="keyword">implements</span> <span class="title class_">LogoutSuccessHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理登出成功事件的方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletRequest  HTTP 请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpServletResponse HTTP 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authentication      包含了有关已进行身份验证的主体的信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果发生 I/O 错误</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果发生 Servlet 异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLogoutSuccess</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">// 如果存在已进行身份验证的主体</span></span><br><span class="line">        <span class="keyword">if</span> (authentication != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 使用 Spring Security 提供的 SecurityContextLogoutHandler 处理登出</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SecurityContextLogoutHandler</span>().logout(httpServletRequest, httpServletResponse, authentication);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置响应的内容类型为 JSON 格式，并指定字符集为 UTF-8</span></span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 清空响应头中的 JWT Token</span></span><br><span class="line">        httpServletResponse.setHeader(JwtUtil.HEADER, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 清空 Spring Security 的上下文</span></span><br><span class="line">        SecurityContextHolder.clearContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建登出成功的 ResultData 对象</span></span><br><span class="line">        ResultData&lt;String&gt; resultDTO = ResultData.success(<span class="string">&quot;SuccessLogout&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取输出流，将 ResultData 对象转为 JSON 字符串并写入响应</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> httpServletResponse.getOutputStream();</span><br><span class="line">        outputStream.write(JSONUtil.toJsonStr(resultDTO).getBytes(StandardCharsets.UTF_8));</span><br><span class="line">        outputStream.flush();</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/user&quot;, produces = &quot;application/json;charset=utf-8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JwtUtil jwtUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationProvider authenticationProvider;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> UserLoginDTO userLoginDTO)</span> &#123;</span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span> authenticationProvider.authenticate(<span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(userLoginDTO.getUsername(), userLoginDTO.getPassword()));</span><br><span class="line">            <span class="comment">// 认证成功</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> jwtUtil.generateToken(userLoginDTO.getUsername());</span><br><span class="line">            Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">            <span class="keyword">return</span> ResultData.success(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@PreAuthorize 配合@EnableGlobalMethodSecurity(prePostEnabled = true) 使用</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;/user/logout&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData <span class="title function_">logout</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// 退出登录</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">auth</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="keyword">if</span> (auth != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//清除认证</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SecurityContextLogoutHandler</span>().logout(request, response, auth);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResultData.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Security-配置"><a href="#Security-配置" class="headerlink" title="Security 配置"></a>Security 配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMethodSecurity(prePostEnabled = true, securedEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] URL_WHITELIST = &#123;<span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;/favicon.ico&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountUserDetailsService accountUserDetailsService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationFilter jwtAuthenticationFilter;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtLogoutSuccessHandler jwtLogoutSuccessHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAccessDeniedHandler jwtAccessDeniedHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginSuccessHandler loginSuccessHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginFailureHandler loginFailureHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置身份认证提供者，用于对用户进行身份验证</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> DaoAuthenticationProvider 实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationProvider <span class="title function_">authenticationProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个用户认证提供者</span></span><br><span class="line">        <span class="type">DaoAuthenticationProvider</span> <span class="variable">authProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DaoAuthenticationProvider</span>();</span><br><span class="line">        <span class="comment">// 设置用户相关信息，可以从数据库中读取、或者缓存、或者配置文件</span></span><br><span class="line">        authProvider.setUserDetailsService(accountUserDetailsService);</span><br><span class="line">        <span class="comment">// 设置加密机制，用于对用户进行身份验证</span></span><br><span class="line">        authProvider.setPasswordEncoder(passwordEncoder());</span><br><span class="line">        <span class="keyword">return</span> authProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置身份验证管理器，用于处理身份验证请求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> config AuthenticationConfiguration 实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> AuthenticationManager 实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">(AuthenticationConfiguration config)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> config.getAuthenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置 Spring Security 过滤器链，定义请求的安全配置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> http HttpSecurity 实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SecurityFilterChain 实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">securityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                <span class="comment">// 禁用 csrf(防止跨站请求伪造攻击)</span></span><br><span class="line">                .csrf(csrf -&gt; csrf.disable())</span><br><span class="line">                <span class="comment">// 配置登录操作</span></span><br><span class="line">                .formLogin(form -&gt; form</span><br><span class="line">                        .loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">                        .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                        .defaultSuccessUrl(<span class="string">&quot;/&quot;</span>).permitAll()</span><br><span class="line">                        .successHandler(loginSuccessHandler)</span><br><span class="line">                        .failureHandler(loginFailureHandler))</span><br><span class="line">                <span class="comment">// 配置登出操作</span></span><br><span class="line">                .logout(logout -&gt; logout.logoutSuccessHandler(jwtLogoutSuccessHandler))</span><br><span class="line">                <span class="comment">// 使用无状态 session，即不使用 session 缓存数据</span></span><br><span class="line">                .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))</span><br><span class="line">                <span class="comment">// 设置白名单，允许特定路径的请求不进行身份验证</span></span><br><span class="line">                .authorizeHttpRequests(auth -&gt; auth</span><br><span class="line">                        .requestMatchers(URL_WHITELIST).permitAll()</span><br><span class="line">                        .anyRequest().authenticated())</span><br><span class="line">                <span class="comment">// 配置异常处理器，处理身份验证和授权异常</span></span><br><span class="line">                .exceptionHandling(exception -&gt; exception</span><br><span class="line">                        .authenticationEntryPoint(jwtAuthenticationEntryPoint)</span><br><span class="line">                        .accessDeniedHandler(jwtAccessDeniedHandler))</span><br><span class="line">                <span class="comment">// 添加 JWT 身份验证过滤器</span></span><br><span class="line">                .authenticationProvider(authenticationProvider())</span><br><span class="line">                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>部署 vue3 项目</p>
<p>登录页</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">        &lt;el-form</span><br><span class="line">                :rules=&quot;rules&quot;</span><br><span class="line">                ref=&quot;loginForm&quot;</span><br><span class="line">                v-loading=&quot;loading&quot;</span><br><span class="line">                element-loading-text=&quot;正在登录...&quot;</span><br><span class="line">                element-loading-spinner=&quot;el-icon-loading&quot;</span><br><span class="line">                element-loading-background=&quot;rgba(0, 0, 0, 0.8)&quot;</span><br><span class="line">                :model=&quot;loginForm&quot;</span><br><span class="line">                class=&quot;loginContainer&quot;&gt;</span><br><span class="line">            &lt;h3 class=&quot;loginTitle&quot;&gt; 系统登录 &lt;/h3&gt;</span><br><span class="line">            &lt;el-form-item prop=&quot;username&quot;&gt;</span><br><span class="line">                &lt;el-input size=&quot;normal&quot; type=&quot;text&quot; v-model=&quot;loginForm.username&quot; auto-complete=&quot;off&quot;</span><br><span class="line">                          placeholder=&quot;请输入用户名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item prop=&quot;password&quot;&gt;</span><br><span class="line">                &lt;el-input size=&quot;normal&quot; type=&quot;password&quot; v-model=&quot;loginForm.password&quot; auto-complete=&quot;off&quot;</span><br><span class="line">                          placeholder=&quot;请输入密码&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-button size=&quot;normal&quot; type=&quot;primary&quot; style=&quot;width: 100%;&quot; @click=&quot;submitLogin&quot;&gt; 登录 &lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">      name: &quot;Login&quot;,</span><br><span class="line">      data()&#123;</span><br><span class="line">        return&#123;</span><br><span class="line">          loading: false,</span><br><span class="line">          rules: &#123;</span><br><span class="line">            username: [&#123;required: true, message: &#x27; 请输入用户名 &#x27;, trigger: &#x27;blur&#x27;&#125;],</span><br><span class="line">            password: [&#123;required: true, message: &#x27; 请输入密码 &#x27;, trigger: &#x27;blur&#x27;&#125;],</span><br><span class="line">          &#125;,</span><br><span class="line">          loginForm: &#123;</span><br><span class="line">            username: &#x27;&#x27;,</span><br><span class="line">            password: &#x27;&#x27;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      mounted() &#123;</span><br><span class="line">        // 在组件加载后，检查本地存储中是否存在用户信息</span><br><span class="line">        const user = window.localStorage.getItem(&#x27;user&#x27;);</span><br><span class="line">        if (user) &#123;</span><br><span class="line">          // 如果用户信息存在，自动跳转到首页</span><br><span class="line">          this.$router.push(&#123; name: &#x27;index&#x27; &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        async postRequest(url, data) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                const response = await this.$axios.post(url, data);</span><br><span class="line">                return response.data;</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                if (error.response) &#123;</span><br><span class="line">                    // 服务器返回错误</span><br><span class="line">                    const status = error.response.status;</span><br><span class="line">                    const errorMessage = error.response.data.message || &quot;Server Error&quot;;</span><br><span class="line">                    </span><br><span class="line">                    if (status === 500 &amp;&amp; errorMessage === &quot;Bad credentials&quot;) &#123;</span><br><span class="line">                        // 处理登录失败的逻辑，比如显示错误信息等</span><br><span class="line">                        alert(&#x27; 用户名或密码错误 &#x27;);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // 处理其他服务器错误</span><br><span class="line">                        console.error(`Server Error: $&#123;status&#125; - $&#123;errorMessage&#125;`);</span><br><span class="line">                        // 显示通用错误提示</span><br><span class="line">                        alert(&quot;服务器发生错误&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 客户端请求错误，如网络问题等</span><br><span class="line">                    console.error(&quot;Client Request Error:&quot;, error.message);</span><br><span class="line">                    // 显示通用错误提示</span><br><span class="line">                    alert(&quot;请求发生错误&quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line"></span><br><span class="line">        async submitLogin() &#123;</span><br><span class="line">            this.$refs.loginForm.validate(async (valid) =&gt; &#123;</span><br><span class="line">                if (valid) &#123;</span><br><span class="line">                    this.loading = true;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        const resp = await this.postRequest(&#x27;sq/user/login&#x27;, this.loginForm);</span><br><span class="line">                        this.loading = false;</span><br><span class="line"></span><br><span class="line">                        if (resp &amp;&amp; resp.code === 200) &#123;</span><br><span class="line">                            // 处理登录成功的逻辑，保存用户信息等</span><br><span class="line">                            localStorage.setItem(&#x27;user&#x27;, resp.data.token);</span><br><span class="line">                            // 跳转到首页</span><br><span class="line">                            this.$router.push(&#123; name: &#x27;index&#x27; &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; catch (error) &#123;</span><br><span class="line">                        alert(&quot;登录失败&quot;);</span><br><span class="line">                        this.loading = false;</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .loginContainer &#123;</span><br><span class="line">        border-radius: 15px;</span><br><span class="line">        background-clip: padding-box;</span><br><span class="line">        margin: 180px auto;</span><br><span class="line">        width: 350px;</span><br><span class="line">        padding: 15px 35px 15px 35px;</span><br><span class="line">        background: #fff;</span><br><span class="line">        border: 1px solid #eaeaea;</span><br><span class="line">        box-shadow: 0 0 25px #cac6c6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .loginTitle &#123;</span><br><span class="line">        margin: 15px auto 20px auto;</span><br><span class="line">        text-align: center;</span><br><span class="line">        color: #505458;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .loginRemember &#123;</span><br><span class="line">        text-align: left;</span><br><span class="line">        margin: 0px 0px 15px 0px;</span><br><span class="line">    &#125;</span><br><span class="line">    .el-form-item__content&#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>首页</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt; 你好 &lt;/h1&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;button @click=&quot;logout()&quot;&gt; 退出登录 &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        methods: &#123;</span><br><span class="line">            async logout() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    await this.$axios.get(&#x27;sq/user/logout&#x27;);</span><br><span class="line">                    // 清除本地存储的用户信息</span><br><span class="line">                    localStorage.removeItem(&#x27;user&#x27;);</span><br><span class="line">                    this.$router.push(&#x27;/login&#x27;);</span><br><span class="line">                &#125; catch (error) &#123;</span><br><span class="line">                    if (error.response) &#123;</span><br><span class="line">                        // 服务器返回错误</span><br><span class="line">                        const status = error.response.status;</span><br><span class="line">                        const errorMessage = error.response.data.message || &quot;Server Error&quot;;</span><br><span class="line">                        </span><br><span class="line">                        if (status === 500 &amp;&amp; errorMessage === &quot;不允许访问&quot;) &#123;</span><br><span class="line">                            // 处理不允许访问的逻辑，比如显示错误信息等</span><br><span class="line">                            alert(&quot;您无权访问&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            // 处理其他服务器错误</span><br><span class="line">                            console.error(`Server Error: $&#123;status&#125; - $&#123;errorMessage&#125;`);</span><br><span class="line">                            // 显示通用错误提示</span><br><span class="line">                            this.$message.error(&quot;服务器发生错误&quot;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // 客户端请求错误，如网络问题等</span><br><span class="line">                        console.error(&quot;Client Request Error:&quot;, error.message);</span><br><span class="line">                        // 显示通用错误提示</span><br><span class="line">                        this.$message.error(&quot;请求发生错误&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;&quot;&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./assets/main.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementPlus</span> <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;element-plus/dist/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Index</span> <span class="keyword">from</span> <span class="string">&#x27;./components/index.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;./components/login.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 VueRouter</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(), <span class="comment">// 指定使用历史模式</span></span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;index&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Index</span>, <span class="attr">meta</span>: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;&#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Login</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 检查是否需要登录权限</span></span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">requiresAuth</span>) &#123;</span><br><span class="line">      <span class="comment">// 从本地存储中获取用户信息</span></span><br><span class="line">      <span class="keyword">const</span> user = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">      <span class="comment">// 如果用户信息不存在，重定向到登录页</span></span><br><span class="line">      <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果存在用户信息，允许访问</span></span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果不需要登录权限，直接允许访问</span></span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 从本地存储或其他地方获取 Token</span></span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;user&#x27;</span>) ? <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;user&#x27;</span>): <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 添加 Authorization 头</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`<span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(router);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 ElementPlus，将 axios 设置为全局属性，并挂载应用</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 axios 设置为全局属性</span></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$axios</span> = axios;</span><br></pre></td></tr></table></figure>

<p>App</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;router-view/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span>;</span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title class_">Vue</span>()],</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/sq&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8080/sq&#x27;</span>, <span class="comment">// 后端的根路径</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">rewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="regexp">/^\/sq/</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="树形结构查询"><a href="#树形结构查询" class="headerlink" title="树形结构查询"></a>树形结构查询</h1><h2 id="数据库表结构-1"><a href="#数据库表结构-1" class="headerlink" title="数据库表结构"></a>数据库表结构</h2><p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202403011535402.png" alt="image-20240301153524227"></p>
<h2 id="表数据"><a href="#表数据" class="headerlink" title="表数据"></a>表数据</h2><p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202403011535020.png" alt="image-20240301153552904"></p>
<h2 id="DTO"><a href="#DTO" class="headerlink" title="DTO"></a>DTO</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountryDTO</span> <span class="keyword">extends</span> <span class="title class_">Country</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">//子节点</span></span><br><span class="line">    List&lt;CountryDTO&gt; countryDTOS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CountryMapper</span> &#123;</span><br><span class="line">    List&lt;CountryDTO&gt; <span class="title function_">selectTreeNodes</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;review.mapper.CountryMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTreeNodes&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;review.pojo.dto.CountryDTO&quot;</span>&gt;</span></span><br><span class="line">        with recursive t1 as (</span><br><span class="line">            select * from china p where id = #&#123;id&#125;</span><br><span class="line">                union all</span><br><span class="line">            select t.* from china t inner join t1 on t1.id = t.parentid</span><br><span class="line">        )</span><br><span class="line">        select *  from t1 order by t1.id, t1.parentid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CountryService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;CountryDTO&gt; <span class="title function_">get</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CountryService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CountryMapper countryMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CountryDTO&gt; <span class="title function_">get</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">//取得数据库数据</span></span><br><span class="line">        List&lt;CountryDTO&gt; countryDTOS = countryMapper.selectTreeNodes(id);</span><br><span class="line">        <span class="comment">//给每个数据都加上 key</span></span><br><span class="line">        Map&lt;String, CountryDTO&gt; collect = countryDTOS.stream()</span><br><span class="line">                .filter(item -&gt; !id.equals(item.getId()))</span><br><span class="line">                <span class="comment">//key 通过 id 获取，value 为对象，如果有重复的 key 取第二个 key 覆盖第一个</span></span><br><span class="line">                .collect(Collectors.toMap(key -&gt; key.getId(), value -&gt; value, (key1, key2) -&gt; key2));</span><br><span class="line">        <span class="comment">//最终返回的集合</span></span><br><span class="line">        List&lt;CountryDTO&gt; countryDTOList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//将子节点放入对应的父节点里</span></span><br><span class="line">        countryDTOS.stream()</span><br><span class="line">                <span class="comment">//排除根节点</span></span><br><span class="line">                .filter(item -&gt; !id.equals(item.getId()))</span><br><span class="line">                <span class="comment">//遍历每个元素</span></span><br><span class="line">                .forEach(item -&gt; &#123;</span><br><span class="line">                    <span class="comment">//如果它的上一个节点为根节点加入集合</span></span><br><span class="line">                    <span class="keyword">if</span>(item.getParentid().equals(id))&#123;</span><br><span class="line">                        countryDTOList.add(item);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//获取上一个节点</span></span><br><span class="line">                    <span class="type">CountryDTO</span> <span class="variable">countryDTO</span> <span class="operator">=</span> collect.get(item.getParentid());</span><br><span class="line">                    <span class="comment">//如果上一个节点不为 null</span></span><br><span class="line">                    <span class="keyword">if</span>(countryDTO != <span class="literal">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(countryDTO.getCountryDTOS() == <span class="literal">null</span>)&#123;</span><br><span class="line">                            countryDTO.setCountryDTOS(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;CountryDTO&gt;());</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//将此节点添加到上一个节点中</span></span><br><span class="line">                        countryDTO.getCountryDTOS().add(item);</span><br><span class="line">                    &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> countryDTOList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Controller-1"><a href="#Controller-1" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountryController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CountryService countryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData&lt;List&lt;CountryDTO&gt;&gt; <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ResultData.success(countryService.get(<span class="string">&quot;0&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/879x/Drawingbed/img/202403011540671.png" alt="image-20240301154046529"></p>
<h1 id="网络图片上传-下载"><a href="#网络图片上传-下载" class="headerlink" title="网络图片上传&#x2F;下载"></a>网络图片上传&#x2F;下载</h1><h2 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span> 我的 <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.container</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.container</span> <span class="selector-tag">img</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">object-fit</span>: cover;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span> 文件上传 <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;uploadForm&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;uploadFile()&quot;</span>&gt;</span> 上传文件 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span> 上传图片预览 <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span> 文件下载 <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;downloadFile()&quot;</span>&gt;</span> 下载文件 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery-3.6.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> fileName;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> data;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 文件上传函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取文件输入框的 DOM 元素</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> fileInput = $(<span class="string">&#x27;#fileInput&#x27;</span>)[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(fileInput)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取选择的文件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(file)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 创建 FormData 对象，用于将文件数据发送到服务器</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">        formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 使用 jQuery 的 AJAX 方法发送文件到后端</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 后端接收文件的 URL</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;/upload&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 请求类型为 POST</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 发送的数据为 FormData 对象</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: formData,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 不对数据进行处理，由 FormData 处理</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">processData</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 不设置内容类型，让浏览器自动识别</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">contentType</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 成功时的回调函数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27; 文件上传成功 &#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                fileName = <span class="title function_">getName</span>(data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;img&quot;</span>).<span class="title function_">setAttribute</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&quot;images/&quot;</span> + data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 失败时的回调函数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27; 文件上传失败:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 文件下载</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">downloadFile</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> url = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;img&quot;</span>).<span class="title function_">getAttribute</span>(<span class="string">&quot;src&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>: <span class="string">&#x27;/download&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fileUrl</span>: <span class="string">&quot;http://localhost/&quot;</span> + url,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fileName</span>: fileName</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xhrFields</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">responseType</span>: <span class="string">&#x27;arraybuffer&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(fileName);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([data], &#123; <span class="attr">type</span>: <span class="string">&quot;application/octet-stream&quot;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                link.<span class="property">href</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span></span><br><span class="line"><span class="language-javascript">                link.<span class="property">download</span> = fileName;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(link);</span></span><br><span class="line"><span class="language-javascript">                link.<span class="title function_">click</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(link);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageController</span> &#123;</span><br><span class="line">    <span class="comment">// 文件上传目录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPLOAD_DIR</span> <span class="operator">=</span> <span class="string">&quot;D:/newImg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultData&lt;String&gt; <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//获取上传文件的字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = file.getBytes();</span><br><span class="line">        <span class="comment">//生成随机的图片命名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="comment">//获取原图片命名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="comment">//截取后缀名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ext</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//拼接新名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uuId + ext;</span><br><span class="line">        <span class="comment">//构建文件路径</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(UPLOAD_DIR + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line">        <span class="comment">//将字节数组写入文件</span></span><br><span class="line">        Files.write(path,bytes);</span><br><span class="line">        <span class="keyword">return</span> ResultData.success(fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用 url 下载</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; downloadFile(<span class="meta">@RequestParam</span> String fileUrl,<span class="meta">@RequestParam</span> String fileName) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//定义一个 URL 对象，就是你想下载的图片的 URL 地址</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(fileUrl);</span><br><span class="line">        <span class="comment">//打开连接</span></span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">        <span class="comment">//设置请求方式为&quot;GET&quot;</span></span><br><span class="line">        connection.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        <span class="comment">//超过响应时间为 10 秒</span></span><br><span class="line">        connection.setConnectTimeout(<span class="number">10</span> * <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//通过输入流获取图片数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> connection.getInputStream();</span><br><span class="line">        <span class="comment">//得到图片的二进制数据，以二进制封装得到数据，具有通用性</span></span><br><span class="line">        <span class="type">byte</span>[] data = readInputStream(is);</span><br><span class="line">        <span class="keyword">return</span> getResponseEntity(fileName, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用上传到本地的图片下载</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/downloadImg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; downloadImg(<span class="meta">@RequestParam</span> String fileName) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//构建文件路径</span></span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(UPLOAD_DIR + <span class="string">&quot;/&quot;</span> + fileName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取文件的字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] data = Files.readAllBytes(path);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getResponseEntity(fileName,data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建响应文件的各种信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; getResponseEntity(String fileName, <span class="type">byte</span>[] data) &#123;</span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">ext</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;.jpg&quot;</span>.equals(ext)) &#123;</span><br><span class="line">            headers.setContentType(MediaType.IMAGE_JPEG);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;.png&quot;</span>.equals(ext))&#123;</span><br><span class="line">            headers.setContentType(MediaType.IMAGE_PNG);</span><br><span class="line">        &#125;</span><br><span class="line">        headers.setContentDispositionFormData(<span class="string">&quot;attachment&quot;</span>, fileName);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok()</span><br><span class="line">                .headers(headers)</span><br><span class="line">                .body(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] readInputStream(InputStream inStream) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">outStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="comment">//创建一个 Buffer 字符串</span></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">6024</span>];</span><br><span class="line">        <span class="comment">//每次读取的字符串长度，如果为-1，代表全部读取完毕</span></span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//使用一个输入流从 buffer 里把数据读取出来</span></span><br><span class="line">        <span class="keyword">while</span> ((len = inStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//用输出流往 buffer 里写入数据，中间参数代表从哪个位置开始读，len 代表读取的长度</span></span><br><span class="line">            outStream.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//关闭输入流</span></span><br><span class="line">        inStream.close();</span><br><span class="line">        <span class="comment">//把 outStream 里的数据写入内存</span></span><br><span class="line">        <span class="keyword">return</span> outStream.toByteArray();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://879x.github.io">幻季</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://879x.github.io/2024/03/03/Java%20%E8%A1%A5%E5%9F%BA%E7%A1%80/">https://879x.github.io/2024/03/03/Java%20%E8%A1%A5%E5%9F%BA%E7%A1%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://879x.github.io" target="_blank">幻季的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E7%A8%8B/">编程</a><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="/img/wallhaven-p22lwj.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240331190850.jpg" target="_blank"><img class="post-qr-code-img" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240331190850.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240331190906.jpg" target="_blank"><img class="post-qr-code-img" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240331190906.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/03/05/Spring%20Cloud/" title="Spring Cloud"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/Amashiro.Natsuki.full.2856783.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring Cloud</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/03/19/Java%20%E4%BD%BF%E7%94%A8thumbnailator%E8%BF%9B%E8%A1%8C%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/" title="Java 使用thumbnailator进行图片处理"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-lm6wjl_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-19</div><div class="title">Java 使用thumbnailator进行图片处理</div></div></a></div><div><a href="/2024/03/05/Spring%20Cloud/" title="Spring Cloud"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/Amashiro.Natsuki.full.2856783.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-05</div><div class="title">Spring Cloud</div></div></a></div><div><a href="/2024/05/24/git%E4%BD%BF%E7%94%A8/" title="git使用"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-28vm5y_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-24</div><div class="title">git使用</div></div></a></div><div><a href="/2024/03/07/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E5%92%8C%E6%94%AF%E4%BB%98%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="微信登录和支付的实现"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-28vm5y_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-07</div><div class="title">微信登录和支付的实现</div></div></a></div><div><a href="/2024/03/07/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/" title="权限管理"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-4orw89_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-07</div><div class="title">权限管理</div></div></a></div><div><a href="/2024/03/28/MongoDB%E7%9A%84%E4%BD%BF%E7%94%A8/" title="MongoDB的使用"><img class="cover" src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-4orw89_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-28</div><div class="title">MongoDB的使用</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">幻季</div><div class="author-info__description">生命不会后退，也不在过去停留。<br/> -M·斯科特·派克- <br/></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/879x/879x.github.io"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/879x" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">幻季的个人博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#IO-%E6%B5%81"><span class="toc-number">1.</span> <span class="toc-text">IO 流</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-IO-%E6%B5%81"><span class="toc-number">1.1.</span> <span class="toc-text">一、什么是 IO 流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B5%81%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">二、流的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81IO-%E6%B5%81%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">1.3.</span> <span class="toc-text">三、IO 流抽象类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Java-%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E6%B5%81-16-%E4%B8%AA"><span class="toc-number">1.4.</span> <span class="toc-text">四、Java 要掌握的流 (16 个)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">五、类的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-FileInputStream"><span class="toc-number">1.5.1.</span> <span class="toc-text">1. FileInputStream</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-FileOutputStream"><span class="toc-number">1.5.2.</span> <span class="toc-text">2. FileOutputStream</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95-1"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-1"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-FileReader"><span class="toc-number">1.5.3.</span> <span class="toc-text">3. FileReader</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95-2"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-2"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-FileWriter"><span class="toc-number">1.5.4.</span> <span class="toc-text">4. FileWriter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95-3"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-3"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-PrintStream"><span class="toc-number">1.5.5.</span> <span class="toc-text">5. PrintStream</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95-4"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95-4"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text">序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Serializable-%E6%8E%A5%E5%8F%A3%E8%B5%B7%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%E5%91%A2%EF%BC%9F"><span class="toc-number">1.6.1.</span> <span class="toc-text">Serializable 接口起什么作用呢？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E7%89%88%E6%9C%AC%E5%8F%B7%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">序列化版本号有什么用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-%E8%AF%AD%E8%A8%80%E4%B8%AD%E6%98%AF%E9%87%87%E7%94%A8%E4%BB%80%E4%B9%88%E6%9C%BA%E5%88%B6%E6%9D%A5%E5%8C%BA%E5%88%86%E7%B1%BB%E7%9A%84"><span class="toc-number">1.6.3.</span> <span class="toc-text">java 语言中是采用什么机制来区分类的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E7%A7%8D%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%BA%8F%E5%88%97%E5%8C%96%E7%89%88%E6%9C%AC%E5%8F%B7%E6%9C%89%E4%BB%80%E4%B9%88%E7%BC%BA%E9%99%B7"><span class="toc-number">1.6.4.</span> <span class="toc-text">这种自动生成序列化版本号有什么缺陷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E4%BD%BF%E6%9F%90%E4%B8%AA%E5%B1%9E%E6%80%A7%E4%B8%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.6.5.</span> <span class="toc-text">怎么使某个属性不序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">1.6.6.</span> <span class="toc-text">结论</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NIO"><span class="toc-number">2.</span> <span class="toc-text">NIO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81NIO-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.</span> <span class="toc-text">一、NIO 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81NIO-%E5%92%8C-BIO"><span class="toc-number">2.2.</span> <span class="toc-text">二、NIO 和 BIO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BIO"><span class="toc-number">2.2.1.</span> <span class="toc-text">BIO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NIO-1"><span class="toc-number">2.2.2.</span> <span class="toc-text">NIO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81NIO-%E7%9A%84%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.3.</span> <span class="toc-text">三、NIO 的核心实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Channel-%E9%80%9A%E9%81%93"><span class="toc-number">2.3.1.</span> <span class="toc-text">Channel(通道)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FileChannel-%E7%B1%BB"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">FileChannel 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SocketChannel-%E7%B1%BB"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">SocketChannel 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ServerSocketChannel-%E7%B1%BB"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">ServerSocketChannel 类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Buffer-%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">2.3.2.</span> <span class="toc-text">Buffer(缓冲区)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Buffer-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">Buffer 数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MappedByteBuffer"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">MappedByteBuffer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Buffer-%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">Buffer 数据流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">缓冲区核心方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Selector-%E9%80%89%E6%8B%A9%E5%99%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">Selector(选择器)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%99%A8%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">选择器使用步骤</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%8C%E4%B8%8B%E8%BD%BD-%E7%90%86%E8%AE%BA%EF%BC%8C%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.</span> <span class="toc-text">Java 实现文件上传，下载 (理论，实践)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.1.</span> <span class="toc-text">服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">3.2.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">3.3.</span> <span class="toc-text">传输工具类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%89%E7%A7%8D%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">一、多线程三种调用方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text">二、多线程基本方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%AD%BB%E9%94%81"><span class="toc-number">4.3.</span> <span class="toc-text">三、死锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81"><span class="toc-number">4.3.1.</span> <span class="toc-text">什么是死锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">4.3.2.</span> <span class="toc-text">死锁产生的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98"><span class="toc-number">4.3.3.</span> <span class="toc-text">如何解决死锁问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E7%8E%AF%E8%B7%AF%E7%AD%89%E5%BE%85%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.3.3.1.</span> <span class="toc-text">改变环路等待条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A0%B4%E5%9D%8F%E8%AF%B7%E6%B1%82%E5%B9%B6%E6%8C%81%E6%9C%89%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.3.3.2.</span> <span class="toc-text">破坏请求并持有条件</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Base64"><span class="toc-number">5.</span> <span class="toc-text">Base64</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BD%95%E4%B8%BA-Base64-%E7%AE%97%E6%B3%95"><span class="toc-number">5.1.</span> <span class="toc-text">一、何为 Base64 算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Base64-%E7%AE%97%E6%B3%95%E6%98%AF%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E7%9A%84"><span class="toc-number">5.2.</span> <span class="toc-text">二、Base64 算法是如何设计的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Base64-%E5%A6%82%E4%BD%95%E8%BD%AC%E6%8D%A2"><span class="toc-number">5.3.</span> <span class="toc-text">三、Base64 如何转换</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">Lambda 表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">一、为什么要使用 Lambda 表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.2.</span> <span class="toc-text">二、Lambda 表达式的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">6.2.1.</span> <span class="toc-text">1.基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%97%A0%E5%8F%82%E6%97%A0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">6.2.2.</span> <span class="toc-text">2. 无参无返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9C%89%E5%8F%82%E6%95%B0%E6%97%A0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">6.2.3.</span> <span class="toc-text">3.有参数无返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9C%89%E5%8F%82%E6%95%B0%E6%97%A0%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%AF%E7%9C%81%E7%95%A5%EF%BC%8C%E7%A7%B0%E4%B8%BA%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD"><span class="toc-number">6.2.4.</span> <span class="toc-text">4.有参数无返回值，数据类型可省略，称为类型推断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">6.2.5.</span> <span class="toc-text">5.有多个参数，有返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90"><span class="toc-number">6.3.</span> <span class="toc-text">三、Lambda 表达式深入解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.3.1.</span> <span class="toc-text">1.什么是函数式接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8"><span class="toc-number">6.3.2.</span> <span class="toc-text">2.函数式接口有什么用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.3.3.</span> <span class="toc-text">3.自定义一个函数式接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC"><span class="toc-number">6.3.4.</span> <span class="toc-text">4.类型推导</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Stream-%E6%B5%81"><span class="toc-number">7.</span> <span class="toc-text">Stream 流</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Stream-%E6%B5%81%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">7.1.</span> <span class="toc-text">一、Stream 流的格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%8E%B7%E5%8F%96%E6%B5%81"><span class="toc-number">7.2.</span> <span class="toc-text">二、获取流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Stream-%E6%B5%81%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">7.3.</span> <span class="toc-text">三、Stream 流的常用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%94%B6%E9%9B%86-Stream-%E6%B5%81"><span class="toc-number">7.4.</span> <span class="toc-text">四、收集 Stream 流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86-Stream-%E6%B5%81%E4%B8%AD%E7%9A%84%E7%BB%93%E6%9E%9C%E5%88%B0%E9%9B%86%E5%90%88"><span class="toc-number">7.4.1.</span> <span class="toc-text">收集 Stream 流中的结果到集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E9%9B%86%E5%90%88%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%88%B0%E6%95%B0%E7%BB%84%E4%B8%AD"><span class="toc-number">7.4.2.</span> <span class="toc-text">收集集合中的数据到数组中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%B5%81%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">7.4.3.</span> <span class="toc-text">对流中的数据的操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jedis"><span class="toc-number">8.</span> <span class="toc-text">Jedis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%8E%B7%E5%8F%96-Jedis"><span class="toc-number">8.1.</span> <span class="toc-text">一、获取 Jedis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Jedis-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">二、Jedis 基本使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot-%E9%9B%86%E6%88%90-Redis"><span class="toc-number">9.</span> <span class="toc-text">SpringBoot 集成 Redis</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring"><span class="toc-number">10.</span> <span class="toc-text">Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81IOC"><span class="toc-number">10.1.</span> <span class="toc-text">一、IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-IOC"><span class="toc-number">10.1.1.</span> <span class="toc-text">什么是 IOC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOC-%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">10.1.2.</span> <span class="toc-text">IOC 的实现方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IOC-%E5%AE%B9%E5%99%A8"><span class="toc-number">10.1.2.1.</span> <span class="toc-text">IOC 容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">10.1.2.2.</span> <span class="toc-text">依赖注入</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81AOP"><span class="toc-number">10.2.</span> <span class="toc-text">二、AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-AOP"><span class="toc-number">10.2.1.</span> <span class="toc-text">什么是 AOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-%E6%B6%89%E5%8F%8A%E5%90%8D%E8%AF%8D"><span class="toc-number">10.2.2.</span> <span class="toc-text">AOP 涉及名词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.2.3.</span> <span class="toc-text">AOP 实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Bean-%E5%AE%B9%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%90%86%E8%AE%BA"><span class="toc-number">10.3.</span> <span class="toc-text">三、Bean 容器基本理论</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Spring-%E6%B3%A8%E8%A7%A3"><span class="toc-number">10.4.</span> <span class="toc-text">四、Spring 注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81SpringBoot-%E6%B3%A8%E8%A7%A3"><span class="toc-number">10.5.</span> <span class="toc-text">五、SpringBoot 注解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringSecurity"><span class="toc-number">11.</span> <span class="toc-text">SpringSecurity</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2-SpringSecurity"><span class="toc-number">11.1.</span> <span class="toc-text">SpringBoot 项目部署 SpringSecurity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">11.1.1.</span> <span class="toc-text">数据库表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pom-%E6%96%87%E4%BB%B6"><span class="toc-number">11.1.2.</span> <span class="toc-text">pom 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yaml-%E9%85%8D%E7%BD%AE"><span class="toc-number">11.1.3.</span> <span class="toc-text">yaml 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">11.1.4.</span> <span class="toc-text">创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mapper-%E7%B1%BB"><span class="toc-number">11.1.5.</span> <span class="toc-text">Mapper 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service-%E7%B1%BB"><span class="toc-number">11.1.6.</span> <span class="toc-text">Service 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82%E5%AE%9E%E4%BD%93"><span class="toc-number">11.1.7.</span> <span class="toc-text">用户登录请求实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%93%8D%E5%BA%94%E5%AE%9E%E4%BD%93"><span class="toc-number">11.1.8.</span> <span class="toc-text">接口响应实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E7%A0%81%E6%9E%9A%E4%B8%BE"><span class="toc-number">11.1.9.</span> <span class="toc-text">响应码枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">11.1.10.</span> <span class="toc-text">统一异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBtaisPlus-%E9%85%8D%E7%BD%AE"><span class="toc-number">11.1.11.</span> <span class="toc-text">MyBtaisPlus 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT-%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">11.1.12.</span> <span class="toc-text">JWT 工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E4%BF%A1%E6%81%AF%E5%AE%9E%E4%BD%93"><span class="toc-number">11.1.13.</span> <span class="toc-text">账户信息实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWTAuthenticationFilter-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.1.14.</span> <span class="toc-text">JWTAuthenticationFilter 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81-%E6%8E%88%E6%9D%83"><span class="toc-number">11.1.15.</span> <span class="toc-text">认证&#x2F;授权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Controller"><span class="toc-number">11.1.16.</span> <span class="toc-text">Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Security-%E9%85%8D%E7%BD%AE"><span class="toc-number">11.1.17.</span> <span class="toc-text">Security 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">11.1.18.</span> <span class="toc-text">前端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">12.</span> <span class="toc-text">树形结构查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%BB%93%E6%9E%84-1"><span class="toc-number">12.1.</span> <span class="toc-text">数据库表结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">12.2.</span> <span class="toc-text">表数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DTO"><span class="toc-number">12.3.</span> <span class="toc-text">DTO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapper"><span class="toc-number">12.4.</span> <span class="toc-text">Mapper</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service"><span class="toc-number">12.5.</span> <span class="toc-text">Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Controller-1"><span class="toc-number">12.6.</span> <span class="toc-text">Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">12.7.</span> <span class="toc-text">结果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0-%E4%B8%8B%E8%BD%BD"><span class="toc-number">13.</span> <span class="toc-text">网络图片上传&#x2F;下载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-1"><span class="toc-number">13.1.</span> <span class="toc-text">前端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">13.2.</span> <span class="toc-text">后端</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/05/24/git%E4%BD%BF%E7%94%A8/" title="git使用"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-28vm5y_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="git使用"/></a><div class="content"><a class="title" href="/2024/05/24/git%E4%BD%BF%E7%94%A8/" title="git使用">git使用</a><time datetime="2024-05-24T02:06:17.000Z" title="发表于 2024-05-24 10:06:17">2024-05-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8GPT/" title="如何使用ChatGPT"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-4orw89_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何使用ChatGPT"/></a><div class="content"><a class="title" href="/2024/05/04/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8GPT/" title="如何使用ChatGPT">如何使用ChatGPT</a><time datetime="2024-05-04T06:19:35.000Z" title="发表于 2024-05-04 14:19:35">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/sql/" title="SQL"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-4orw89_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SQL"/></a><div class="content"><a class="title" href="/2024/05/04/sql/" title="SQL">SQL</a><time datetime="2024-05-04T06:01:22.000Z" title="发表于 2024-05-04 14:01:22">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/28/MongoDB%E7%9A%84%E4%BD%BF%E7%94%A8/" title="MongoDB的使用"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-4orw89_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MongoDB的使用"/></a><div class="content"><a class="title" href="/2024/03/28/MongoDB%E7%9A%84%E4%BD%BF%E7%94%A8/" title="MongoDB的使用">MongoDB的使用</a><time datetime="2024-03-28T09:25:48.000Z" title="发表于 2024-03-28 17:25:48">2024-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/27/java%E4%BD%BF%E7%94%A8minio/" title="Java使用MinIO"><img src= "/img/5f47a60d5146459eb21b9f7bab476163ee81c664.gif@!web-article-pic.webp" data-lazy-src="/img/wallhaven-p2e71j_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java使用MinIO"/></a><div class="content"><a class="title" href="/2024/03/27/java%E4%BD%BF%E7%94%A8minio/" title="Java使用MinIO">Java使用MinIO</a><time datetime="2024-03-27T02:30:50.000Z" title="发表于 2024-03-27 10:30:50">2024-03-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By 幻季</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'mEcl3ljE8Xejd5tGMxU8pycK-gzGzoHsz',
      appKey: '56r5hEb4WhpvTy6D2xTrOA1q',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>(() => {
  const isChatBtn = true
  const isChatHideShow = true

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = {
      startHidden: true
    }
  
    window.chatBtnFn = () => {
      const isShow = document.getElementById('chatra').classList.contains('chatra--expanded')
      isShow ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        Chatra('hide')
      },
      show: () => {
        Chatra('show')
      }
    }
  }

  (function(d, w, c) {
    w.ChatraID = 'y8G9wcHsgfcBL4ARw'
    var s = d.createElement('script')
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')

})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>